<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>JDBC总 | LuckyFeng的博客</title><meta name="description" content="JDBC总"><meta name="keywords" content="JDBC"><meta name="author" content="覃烽"><meta name="copyright" content="覃烽"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="JDBC总"><meta name="twitter:description" content="JDBC总"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="og:type" content="article"><meta property="og:title" content="JDBC总"><meta property="og:url" content="http://example.com/2021/08/31/JDBC%E6%80%BB/"><meta property="og:site_name" content="LuckyFeng的博客"><meta property="og:description" content="JDBC总"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://example.com/2021/08/31/JDBC%E6%80%BB/"><link rel="prev" title="mybatis学习(一)" href="http://example.com/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/"><link rel="next" title="part06_视图和limit" href="http://example.com/2021/08/31/part06-%E8%A7%86%E5%9B%BE%E5%92%8Climit/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'false',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">LuckyFeng的博客</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 框架</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="https://s3.bmp.ovh/imgs/2021/08/537218da738c4aaa.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">44</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">17</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 框架</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#JDBC%E6%A6%82%E8%BF%B0"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">JDBC概述</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%A0%B8%E5%BF%83%E7%9A%84api"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">核心的api</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Driver-I"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">Driver[I]</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#DriverManager-C"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">DriverManager[C]</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Connnection-I"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">Connnection[I]</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Statement-I"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">Statement[I]</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ResultSet-I"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text">ResultSet[I]</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#jdb%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">jdb编程步骤</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#demo"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">demo</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#ORM-OO%E5%88%86%E6%9E%90"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">ORM+OO分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#OO-%E8%AE%BE%E8%AE%A1%E8%A1%A8"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">OO-设计表</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#ORM"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">ORM</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%88%B6%E5%AE%9A%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">制定业务接口</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc_mobile_items-number">4.3.1.</span> <span class="toc_mobile_items-text">接口实现类</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%86%99%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95junit"><span class="toc_mobile_items-number">4.4.</span> <span class="toc_mobile_items-text">写单元测试junit</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E7%AC%AC%E4%B8%80%E5%B1%82%E5%B0%81%E8%A3%85"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">第一层封装</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E4%BD%9C%E4%B8%9A"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">作业</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%9F%BA%E7%A1%80%E7%9A%84%E4%BD%9C%E4%B8%9A"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text">基础的作业</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E7%BA%A7%E8%81%94%E6%93%8D%E4%BD%9C"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text">级联操作</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">SQL注入</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#PrepareStatement-I"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">PrepareStatement[I]</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#PrepareStatement%E5%92%8CStatement%E5%8C%BA%E5%88%AB"><span class="toc_mobile_items-number">8.1.</span> <span class="toc_mobile_items-text">PrepareStatement和Statement区别</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%90%8C%E6%9E%84sql%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc_mobile_items-number">8.2.</span> <span class="toc_mobile_items-text">同构sql的场景</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E6%93%8D%E4%BD%9C"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">批处理操作</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E7%AC%AC%E4%BA%8C%E5%B1%82%E5%B0%81%E8%A3%85"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text">第二层封装</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E6%A8%A1%E6%9D%BF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc_mobile_items-number">10.1.</span> <span class="toc_mobile_items-text">模板设计模式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#JdbcTemplate-%E8%87%AA%E5%AE%9A%E4%B9%89jdbc%E6%A8%A1%E6%9D%BF%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc_mobile_items-number">10.2.</span> <span class="toc_mobile_items-text">JdbcTemplate - 自定义jdbc模板工具类</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#idea%E9%85%8D%E7%BD%AEdatasource"><span class="toc_mobile_items-number">11.</span> <span class="toc_mobile_items-text">idea配置datasource</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E7%BA%A7%E8%81%94%E6%8F%92%E5%85%A5"><span class="toc_mobile_items-number">12.</span> <span class="toc_mobile_items-text">级联插入</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc_mobile_items-number">12.1.</span> <span class="toc_mobile_items-text">事务</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E4%BD%9C%E4%B8%9A-1"><span class="toc_mobile_items-number">13.</span> <span class="toc_mobile_items-text">作业</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#DTO"><span class="toc_mobile_items-number">14.</span> <span class="toc_mobile_items-text">DTO</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%A4%9A%E6%9D%A1%E4%BB%B6%E7%BB%84%E5%90%88%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc_mobile_items-number">15.</span> <span class="toc_mobile_items-text">多条件组合分页查询</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82-service"><span class="toc_mobile_items-number">15.1.</span> <span class="toc_mobile_items-text">业务逻辑层 - service</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc_mobile_items-number">16.</span> <span class="toc_mobile_items-text">元数据</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86ResultSet"><span class="toc_mobile_items-number">16.1.</span> <span class="toc_mobile_items-text">重新认识ResultSet</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#demo-1"><span class="toc_mobile_items-number">16.1.1.</span> <span class="toc_mobile_items-text">demo</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc_mobile_items-number">17.</span> <span class="toc_mobile_items-text">数据库连接池</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#DriverManager%E6%96%B9%E5%BC%8F%E7%BC%BA%E9%99%B7"><span class="toc_mobile_items-number">17.1.</span> <span class="toc_mobile_items-text">DriverManager方式缺陷</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0%E9%80%89%E6%8B%A9"><span class="toc_mobile_items-number">17.2.</span> <span class="toc_mobile_items-text">连接池选择</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc_mobile_items-number">17.3.</span> <span class="toc_mobile_items-text">连接池的基本原理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc_mobile_items-number">17.4.</span> <span class="toc_mobile_items-text">连接池的工作原理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc_mobile_items-number">17.5.</span> <span class="toc_mobile_items-text">为什么要使用连接池</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE-%E9%83%A8%E5%88%86"><span class="toc_mobile_items-number">17.6.</span> <span class="toc_mobile_items-text">相关配置-部分</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%89%8B%E6%92%B8%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc_mobile_items-number">18.</span> <span class="toc_mobile_items-text">手撸连接池</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc_mobile_items-number">18.1.</span> <span class="toc_mobile_items-text">代理模式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E9%9C%80%E6%B1%82"><span class="toc_mobile_items-number">18.2.</span> <span class="toc_mobile_items-text">需求</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86"><span class="toc_mobile_items-number">18.3.</span> <span class="toc_mobile_items-text">不使用代理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc_mobile_items-number">18.4.</span> <span class="toc_mobile_items-text">静态代理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc_mobile_items-number">18.5.</span> <span class="toc_mobile_items-text">动态代理</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc_mobile_items-number">19.</span> <span class="toc_mobile_items-text">使用第三方连接池</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc_mobile_items-number">19.1.</span> <span class="toc_mobile_items-text">步骤</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#DB%E8%AE%BE%E8%AE%A1%E4%B9%8B%E5%90%8E"><span class="toc_mobile_items-number">20.</span> <span class="toc_mobile_items-text">DB设计之后</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#jdbc%E6%8B%93%E5%B1%95"><span class="toc_mobile_items-number">21.</span> <span class="toc_mobile_items-text">jdbc拓展</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#jdbc%E7%BC%BA%E9%99%B7"><span class="toc_mobile_items-number">21.1.</span> <span class="toc_mobile_items-text">jdbc缺陷</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc_mobile_items-number">21.2.</span> <span class="toc_mobile_items-text">实体类的设计</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc_mobile_items-number">21.2.1.</span> <span class="toc_mobile_items-text">案例</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E9%9C%80%E6%B1%82-1"><span class="toc_mobile_items-number">21.3.</span> <span class="toc_mobile_items-text">需求</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E5%8D%95%E8%A1%A8%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc_mobile_items-number">21.3.1.</span> <span class="toc_mobile_items-text">单表的解决方案</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%9B%9E%E9%A1%BE%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc_mobile_items-number">22.</span> <span class="toc_mobile_items-text">回顾动态代理</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E6%89%8B%E6%92%B8%E8%BF%9E%E6%8E%A5%E6%B1%A0-1"><span class="toc_mobile_items-number">22.1.</span> <span class="toc_mobile_items-text">手撸连接池</span></a></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JDBC%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">JDBC概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%9A%84api"><span class="toc-number">2.</span> <span class="toc-text">核心的api</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Driver-I"><span class="toc-number">2.1.</span> <span class="toc-text">Driver[I]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DriverManager-C"><span class="toc-number">2.2.</span> <span class="toc-text">DriverManager[C]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Connnection-I"><span class="toc-number">2.3.</span> <span class="toc-text">Connnection[I]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Statement-I"><span class="toc-number">2.4.</span> <span class="toc-text">Statement[I]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ResultSet-I"><span class="toc-number">2.5.</span> <span class="toc-text">ResultSet[I]</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jdb%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.</span> <span class="toc-text">jdb编程步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#demo"><span class="toc-number">3.1.</span> <span class="toc-text">demo</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ORM-OO%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">ORM+OO分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#OO-%E8%AE%BE%E8%AE%A1%E8%A1%A8"><span class="toc-number">4.1.</span> <span class="toc-text">OO-设计表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ORM"><span class="toc-number">4.2.</span> <span class="toc-text">ORM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B6%E5%AE%9A%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.</span> <span class="toc-text">制定业务接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">4.3.1.</span> <span class="toc-text">接口实现类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95junit"><span class="toc-number">4.4.</span> <span class="toc-text">写单元测试junit</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%B1%82%E5%B0%81%E8%A3%85"><span class="toc-number">5.</span> <span class="toc-text">第一层封装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A"><span class="toc-number">6.</span> <span class="toc-text">作业</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9A%84%E4%BD%9C%E4%B8%9A"><span class="toc-number">6.1.</span> <span class="toc-text">基础的作业</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A7%E8%81%94%E6%93%8D%E4%BD%9C"><span class="toc-number">6.2.</span> <span class="toc-text">级联操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">SQL注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PrepareStatement-I"><span class="toc-number">8.</span> <span class="toc-text">PrepareStatement[I]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PrepareStatement%E5%92%8CStatement%E5%8C%BA%E5%88%AB"><span class="toc-number">8.1.</span> <span class="toc-text">PrepareStatement和Statement区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%9E%84sql%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">8.2.</span> <span class="toc-text">同构sql的场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E6%93%8D%E4%BD%9C"><span class="toc-number">9.</span> <span class="toc-text">批处理操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%B1%82%E5%B0%81%E8%A3%85"><span class="toc-number">10.</span> <span class="toc-text">第二层封装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">10.1.</span> <span class="toc-text">模板设计模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JdbcTemplate-%E8%87%AA%E5%AE%9A%E4%B9%89jdbc%E6%A8%A1%E6%9D%BF%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">10.2.</span> <span class="toc-text">JdbcTemplate - 自定义jdbc模板工具类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#idea%E9%85%8D%E7%BD%AEdatasource"><span class="toc-number">11.</span> <span class="toc-text">idea配置datasource</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A7%E8%81%94%E6%8F%92%E5%85%A5"><span class="toc-number">12.</span> <span class="toc-text">级联插入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">12.1.</span> <span class="toc-text">事务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-1"><span class="toc-number">13.</span> <span class="toc-text">作业</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DTO"><span class="toc-number">14.</span> <span class="toc-text">DTO</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E6%9D%A1%E4%BB%B6%E7%BB%84%E5%90%88%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">15.</span> <span class="toc-text">多条件组合分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82-service"><span class="toc-number">15.1.</span> <span class="toc-text">业务逻辑层 - service</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">16.</span> <span class="toc-text">元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86ResultSet"><span class="toc-number">16.1.</span> <span class="toc-text">重新认识ResultSet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#demo-1"><span class="toc-number">16.1.1.</span> <span class="toc-text">demo</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">17.</span> <span class="toc-text">数据库连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DriverManager%E6%96%B9%E5%BC%8F%E7%BC%BA%E9%99%B7"><span class="toc-number">17.1.</span> <span class="toc-text">DriverManager方式缺陷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0%E9%80%89%E6%8B%A9"><span class="toc-number">17.2.</span> <span class="toc-text">连接池选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">17.3.</span> <span class="toc-text">连接池的基本原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">17.4.</span> <span class="toc-text">连接池的工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">17.5.</span> <span class="toc-text">为什么要使用连接池</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE-%E9%83%A8%E5%88%86"><span class="toc-number">17.6.</span> <span class="toc-text">相关配置-部分</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%8B%E6%92%B8%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">18.</span> <span class="toc-text">手撸连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">18.1.</span> <span class="toc-text">代理模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">18.2.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86"><span class="toc-number">18.3.</span> <span class="toc-text">不使用代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">18.4.</span> <span class="toc-text">静态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">18.5.</span> <span class="toc-text">动态代理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">19.</span> <span class="toc-text">使用第三方连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">19.1.</span> <span class="toc-text">步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DB%E8%AE%BE%E8%AE%A1%E4%B9%8B%E5%90%8E"><span class="toc-number">20.</span> <span class="toc-text">DB设计之后</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jdbc%E6%8B%93%E5%B1%95"><span class="toc-number">21.</span> <span class="toc-text">jdbc拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#jdbc%E7%BC%BA%E9%99%B7"><span class="toc-number">21.1.</span> <span class="toc-text">jdbc缺陷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">21.2.</span> <span class="toc-text">实体类的设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">21.2.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82-1"><span class="toc-number">21.3.</span> <span class="toc-text">需求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">21.3.1.</span> <span class="toc-text">单表的解决方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9E%E9%A1%BE%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">22.</span> <span class="toc-text">回顾动态代理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E6%92%B8%E8%BF%9E%E6%8E%A5%E6%B1%A0-1"><span class="toc-number">22.1.</span> <span class="toc-text">手撸连接池</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="post-info"><div id="post-title"><div class="posttitle">JDBC总</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-08-31<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-08-31</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/JDBC/">JDBC</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon" aria-hidden="true"></i><span>字数总计: </span><span class="word-count">11.6k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon" aria-hidden="true"></i><span>阅读时长: 45 分钟</span><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="JDBC概述"><a href="#JDBC概述" class="headerlink" title="JDBC概述"></a>JDBC概述</h1><blockquote>
<ol>
<li>jdbc - java database connectivity - <strong>java数据库连接</strong></li>
</ol>
<p>使用java编写的程序来访问数据库的技术.优势在于可以使用同一套java代码来访问市面上不同的数据库.</p>
<p><strong>作用:为访问不同的数据库来提供统一的方式.</strong></p>
<p>市面上主流的关系型数据库:sqlserver,<strong>oracle,mysql</strong></p>
<p>非关系型数据库:文档型数据库 - mongodb.键值对数据库-redis</p>
<ol start="2">
<li>属于早期的JAVAEE[jakartaEE]十三种核心技术中的一种.</li>
<li>这个技术已经被淘汰了.属于**持久层[数据访问层 - 和DB交互的层]**的最传统的技术.持久层框架的底层都是采用的jdbc技术.</li>
</ol>
<p>市面上有很多持久层的框架,主流的ORM[Object Relation Mapping 对象关系映射]框架.</p>
<p>ORM本质上是一个思想,在这个思想下诞生了很多ORM框架[实际上就是ORM思想的实现者]</p>
<p>3-1. 非移动互联网时代 - Hibernate框架[全自动的ORM框架 - 不需要写sql语句 - 不能进行sql优化]</p>
<p>3-2. 大数据时代 - **Mybatis[**半自动的ORM框架,需要写sql,但是相对于jdbc技术稍微简单一点,可以进行sql优化]</p>
<p>3-3. 国产的Mybatis-plus框架 - 又是对Mybatis的进一步的封装</p>
</blockquote>
<h1 id="核心的api"><a href="#核心的api" class="headerlink" title="核心的api"></a>核心的api</h1><h2 id="Driver-I"><a href="#Driver-I" class="headerlink" title="Driver[I]"></a>Driver[I]</h2><blockquote>
<p>驱动接口 - 驱动实现类是由各个db厂商去实现的.</p>
</blockquote>
<blockquote>
<ol>
<li>java.sql.Driver[I]</li>
</ol>
<p>驱动jar - mysql-connector-java-8.0.25.jar - 本质就是对sun公司制定的Driver接口的实现类.</p>
<p>想要使用哪个db厂商的db,那么就导入哪个db的驱动jar.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">-- 历史</span><br><span class="line">-- java-sun公司-oracle公司收购了[oracle数据库-收费]</span><br><span class="line">               </span><br><span class="line">伪代码 java-oracle</span><br><span class="line">               </span><br><span class="line"><span class="comment">//jdbc编程第一步 - 创建一个驱动类对象</span></span><br><span class="line">OracleDriver driver = <span class="keyword">new</span> OraclerDiver();</span><br><span class="line">               </span><br><span class="line">-- java语言发展壮大了,mysql原先是不属于oracle.</span><br><span class="line">-- java-mysql</span><br><span class="line">MysqlDriver driver = <span class="keyword">new</span> MysqlDriver();</span><br><span class="line">               </span><br><span class="line"><span class="comment">//代码的可维护性不是太好.java代码不能随便切换数据库了;</span></span><br><span class="line"><span class="comment">//因为db厂商不一样[类,接口命名都不一样]</span></span><br><span class="line">               </span><br><span class="line"><span class="comment">//有多少个db,就得写多少套java代码</span></span><br><span class="line"><span class="comment">//sun考虑到这一点,制定了一系列的接口[居多]和类</span></span><br><span class="line"><span class="comment">//接口作用就是用来指定一个规范,&quot;契约&quot;.</span></span><br><span class="line">               </span><br><span class="line"><span class="comment">//jdk-api - 查得到java.sql.Driver[I]</span></span><br><span class="line">               </span><br><span class="line"><span class="comment">//sun - db厂商下的db要和java交互的.必须遵守我的规范.你们这些db厂商只要给我实现这个规范接口.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Driver</span></span>&#123;</span><br><span class="line">  <span class="function">Driver <span class="title">getInstance</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">               </span><br><span class="line"><span class="comment">//oracle遵守规范</span></span><br><span class="line">               </span><br><span class="line"><span class="comment">//sqlserver,mysql遵守规范</span></span><br><span class="line">               </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OracleDriver</span> <span class="keyword">implements</span> <span class="title">Driver</span></span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Driver <span class="title">getIntance</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//db是不同的,每个厂商程序根据具体的db产品来的</span></span><br><span class="line">               </span><br><span class="line">    <span class="comment">//具体的实现肯定是由db厂商去实现...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> OracleDriver();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">               </span><br><span class="line"><span class="comment">//sqlserver - ms</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlServerDriver</span> <span class="keyword">implements</span> <span class="title">Driver</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Driver <span class="title">getIntance</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//db是不同的,每个厂商程序根据具体的db产品来的</span></span><br><span class="line">               </span><br><span class="line">    <span class="comment">//具体的实现肯定是由db厂商去实现...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SqlServerDriver();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">               </span><br><span class="line"><span class="comment">//每个db厂商就会把这些实现类全部打包 - mysql-connector-java-8.0.25.jar</span></span><br><span class="line">               </span><br><span class="line"><span class="comment">//java = oracle</span></span><br><span class="line"><span class="comment">//多态 - 面向接口编程</span></span><br><span class="line"><span class="comment">//---&gt; 反射实现 ---</span></span><br><span class="line">Driver driver = XXX.getInstance();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				java-app[面向接口编程]			</span><br><span class="line">	   	   	   	   	   	</span><br><span class="line">			 J D B C [指定了很多接口]</span><br><span class="line">			   sqlserver[接口的实现]       mysql[接口的实现</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="DriverManager-C"><a href="#DriverManager-C" class="headerlink" title="DriverManager[C]"></a>DriverManager[C]</h2><blockquote>
<p>sun - java.sql.DriverManager[C] - 驱动管理类,管理注册驱动.<strong>通过驱动管理类来获取DB连接</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url - 不同的数据库 - url是不一样的</span><br><span class="line">user - db用户名</span><br><span class="line">password - db密码</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String url, String user, String password)</span></span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><code>关于数据库连接的url如何设置</code></p>
<ol>
<li>主协议:次协议://数据库主机地址:数据库端口号/db名称?连接属性key=连接属性值</li>
</ol>
<p>比如jdbc:mysql://localhost:3306/数据名?key1=value1&amp;key2=value2…</p>
<ol start="2">
<li>常见的url的设置如下</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql:<span class="comment">//localhost:3306/j03s</span></span><br><span class="line">                  </span><br><span class="line">-- 高版本的需要设置useSSL=<span class="keyword">true</span>,否则会报警告</span><br><span class="line">jdbc:mysql:<span class="comment">//localhost:3306/j03s?useSSL=true</span></span><br><span class="line">                  </span><br><span class="line">-- 设置编码</span><br><span class="line">jdbc:mysql:<span class="comment">//localhost:3306/j03s?useSSL=true&amp;characterEncoding=utf-8</span></span><br><span class="line">                  </span><br><span class="line">-- 继续设置时区</span><br><span class="line">-- 世界的标准时区 - UTC</span><br><span class="line">-- 中国的标准时区 - Asia/Shanghai</span><br><span class="line">jdbc:mysql:<span class="comment">//localhost:3306/j03s?useSSL=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Connnection-I"><a href="#Connnection-I" class="headerlink" title="Connnection[I]"></a>Connnection[I]</h2><blockquote>
<p>连接对象.和db进行一次会话</p>
<p><strong>Statetement createStatement();//获取语句对象</strong></p>
<p><strong>PreparedStatement prepareStatement(String sql);//利用一条sql构建预编译语句对象</strong></p>
</blockquote>
<h2 id="Statement-I"><a href="#Statement-I" class="headerlink" title="Statement[I]"></a>Statement[I]</h2><blockquote>
<p>语句对象 - 作用-负责将sql语句发送给mysql-server端进行sql编译和解释</p>
<p>如果发送的是dql语句,mysql-server会将查询的结果返回,封装到一个ResultSet对象中.</p>
</blockquote>
<blockquote>
<p>sun - java.sql.Statement[I]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="function"><span class="keyword">int</span> <span class="title">executeUpdate</span><span class="params">(String sql)</span></span>;<span class="comment">//执行的是dml操作,返回的是受影响的行数</span></span><br><span class="line"><span class="number">2.</span> <span class="function">ResultSet <span class="title">executeQuery</span><span class="params">(String sql)</span></span>;<span class="comment">//执行的dql操作.处理结果集对象ResultSet</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="ResultSet-I"><a href="#ResultSet-I" class="headerlink" title="ResultSet[I]"></a>ResultSet[I]</h2><blockquote>
<p>本质上一个游标-光标,默认是在标题行,在数据行的上方.比如要想取第一行的数据,应该是要将这个游标向下移动一行.</p>
<ol>
<li>booelan next();//向下移动一行.如果下一行没有数据行了,自动返回false</li>
<li>int getInt(int index);//比如id列是int型,序号是从1开始的</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select id,first_name fname from s_emp;</span><br><span class="line"></span><br><span class="line">rs.next();</span><br><span class="line">int id = rs.getInt(1);</span><br><span class="line">String first_name = rs.getString(2);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>String getString(int index);//比如name列是varchar</li>
<li>int getInt(String colName);//根据列的名称去取</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> id = rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">String firstName = rs.getString(<span class="string">&quot;fname&quot;</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="jdb编程步骤"><a href="#jdb编程步骤" class="headerlink" title="jdb编程步骤"></a>jdb编程步骤</h1><blockquote>
<ol>
<li>加载驱动 - 加载驱动实现类 - Driver</li>
<li>获取连接 - 和db进行连接 - DriverManager</li>
<li>获取语句对象Statement</li>
</ol>
<p>3-1. 写sql语句</p>
<p>3-2. 由语句对象将sql发送到mysql-server,如果执行的是DQL,还需要进行结果集处理,执行第4步</p>
<ol start="4">
<li>处理结果集 - 通过光标来获取表中的数据 - ResultSet</li>
<li>关闭对象-ResultSet,Statement,Connection</li>
</ol>
</blockquote>
<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.day01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: jdbc基本编程步骤 - 感受一下jdbc编程</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/25 1:34 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloJdbcDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1. 加载驱动 - 驱动类加载到java内存中.</span></span><br><span class="line">        <span class="comment">//但是jdbc4.0规范及其以后-加载驱动的代码可以省略不写. - 默认加载</span></span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        Statement st = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2. 获取连接 - 通过DriverManager类提供的getConnection来进行获取的</span></span><br><span class="line">            <span class="comment">//2-1. 准备三个参数</span></span><br><span class="line">            String url = <span class="string">&quot;jdbc:mysql://localhost:3306/j03s?useSSL=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai&quot;</span>;</span><br><span class="line">            String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            String password = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            conn = DriverManager.getConnection(url,user,password);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3. 创建语句对象</span></span><br><span class="line">            st = conn.createStatement();</span><br><span class="line">            <span class="comment">//作用-负责将sql语句发送给mysql-server端进行sql编译和解释</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//4. 发送sql,并且由mysql-server编译执行</span></span><br><span class="line">            String sql = <span class="string">&quot;select id,first_name,salary from s_emp&quot;</span>;</span><br><span class="line">            <span class="comment">//4-1. 因为执行的是DQL语句,返回一个结果集对象</span></span><br><span class="line">            rs = st.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5. 如果是DQL - 处理一下结果集</span></span><br><span class="line">            <span class="comment">//结果解对象ResultSet实际上是一个光标 - 停留在标题行的上方.</span></span><br><span class="line">            <span class="comment">//调用next方法的时候,光标就会向下移动一行.如果下方没有数据行的时候,自动返回false</span></span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                <span class="comment">//获取查询语句中数据 - 注意一下调用的类型</span></span><br><span class="line">                <span class="comment">//列-int-&gt;getInt方法</span></span><br><span class="line">                <span class="comment">//列-varchar-&gt;getString方法</span></span><br><span class="line">                <span class="comment">//列-date-&gt;getDate方法</span></span><br><span class="line">                <span class="comment">//列-float/double-&gt;getDouble方法</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//getString方法是可以获取任意类型的列的.</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//根据序号取 - 查询列的序号,不是原表中的序号.</span></span><br><span class="line">                <span class="comment">//序号从1开始</span></span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                <span class="comment">//根据列的名称/别名 去取</span></span><br><span class="line">                String firstName = rs.getString(<span class="string">&quot;first_name&quot;</span>);</span><br><span class="line">                <span class="keyword">double</span> salary = rs.getDouble(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">                System.out.println(id+<span class="string">&quot;\t&quot;</span>+firstName+<span class="string">&quot;\t&quot;</span>+salary);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6. 关闭资源 - 一定要注意一下顺序.</span></span><br><span class="line">            <span class="comment">//先关闭rs,然后是st,然后是conn</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>!=rs)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    rs.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>!=st)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    st.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>!=conn)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ORM-OO分析"><a href="#ORM-OO分析" class="headerlink" title="ORM+OO分析"></a>ORM+OO分析</h1><blockquote>
<p>OO过程 - db设计[发现很多之前没有注意到的业务细节] - 业务中的关键对象</p>
</blockquote>
<h2 id="OO-设计表"><a href="#OO-设计表" class="headerlink" title="OO-设计表"></a>OO-设计表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table t_user;</span><br><span class="line">create table t_user(</span><br><span class="line">	id int(7) primary key auto_increment,</span><br><span class="line">  username varchar(20) unique not null,</span><br><span class="line">  password varchar(20) not null,</span><br><span class="line">  birthday date</span><br><span class="line">);</span><br><span class="line">insert into t_user values(1,&#x27;admin&#x27;,&#x27;123&#x27;,now());</span><br><span class="line">insert into t_user values(2,&#x27;tom&#x27;,&#x27;123&#x27;,now());</span><br></pre></td></tr></table></figure>

<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">表 			- 		   实体</span><br><span class="line">主键列id         对象标识id</span><br><span class="line">普通列           普通属性</span><br><span class="line">外键             对象与对象之间的关系 - 对象之间是没有什么关键关系</span><br><span class="line">  							要么关联单个对象/集合对象</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> -&gt; Integer</span><br><span class="line">varchar -&gt; String</span><br><span class="line"><span class="keyword">float</span>/<span class="keyword">double</span> -&gt; Double</span><br><span class="line">date/datetime -&gt; java.util.Date</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">//实体类中的属性都是根据db设计来写的</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="制定业务接口"><a href="#制定业务接口" class="headerlink" title="制定业务接口"></a>制定业务接口</h2><blockquote>
<p>IUserDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"> <span class="comment">//具体的操作功能</span></span><br><span class="line"> <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="接口实现类"><a href="#接口实现类" class="headerlink" title="接口实现类"></a>接口实现类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tech.aistar.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> tech.aistar.model.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: 持久层的实现类 - jdbc代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/25 2:17 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 加载驱动-省略</span></span><br><span class="line">        <span class="comment">//2. 获取连接</span></span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        Statement st = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            String url = <span class="string">&quot;jdbc:mysql://localhost:3306/j03s?useSSL=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai&quot;</span>;</span><br><span class="line">            String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            String password = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            conn = DriverManager.getConnection(url,user,password);</span><br><span class="line">            <span class="comment">//3. 创建语句对象</span></span><br><span class="line">            st = conn.createStatement();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4. 发送sql</span></span><br><span class="line">            String sql = <span class="string">&quot;select * from t_user&quot;</span>;</span><br><span class="line"></span><br><span class="line">            rs = st.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5. 处理结果集</span></span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                String username = rs.getString(<span class="number">2</span>);</span><br><span class="line">                String pwd = rs.getString(<span class="number">3</span>);</span><br><span class="line">                Date birthday = rs.getDate(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//对象是数据在内存中的载体,对象 - 特殊的数组容器</span></span><br><span class="line">                User u = <span class="keyword">new</span> User();</span><br><span class="line">                u.setId(id);</span><br><span class="line">                u.setUsername(username);</span><br><span class="line">                u.setPassword(password);</span><br><span class="line">                u.setBirthday(birthday);</span><br><span class="line"></span><br><span class="line">                users.add(u);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//6. 关闭资源 - 一定要注意一下顺序.</span></span><br><span class="line">            <span class="comment">//先关闭rs,然后是st,然后是conn</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>!=rs)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    rs.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>!=st)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    st.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span>!=conn)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="写单元测试junit"><a href="#写单元测试junit" class="headerlink" title="写单元测试junit"></a>写单元测试junit</h2><p>在项目根目录下新建一个test目录 - 右击它 - mark direcotry as - Test Sources Root</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> tech.aistar.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> tech.aistar.model.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: 针对IUserDao接口中的方法进行逐一单元测试</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/25 2:24 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoTest</span> </span>&#123;</span><br><span class="line">    IUserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=users &amp;&amp; users.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            users.forEach(System.out::println);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="第一层封装"><a href="#第一层封装" class="headerlink" title="第一层封装"></a>第一层封装</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: jdbc工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/25 3:06 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/j03s?useSSL=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url,user,password);</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Statement st, Connection conn)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=st)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                st.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=conn)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放资源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> st</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(ResultSet rs, Statement st, Connection conn)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=rs)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=st)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                st.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>!=conn)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h1><blockquote>
<p>一个用户可以发布多个视频</p>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">drop table t_video;</span><br><span class="line">create table t_video(</span><br><span class="line">	id int(7) primary key auto_increment,</span><br><span class="line">title varchar(20) not null,</span><br><span class="line">create_date datetime,</span><br><span class="line">price double(7,2),</span><br><span class="line">video_url varchar(120),</span><br><span class="line">-- 不需要创建外键约束,但是仍然需要通过user_id确定和t_user表的关系</span><br><span class="line">-- Video实体类中 - private User user;</span><br><span class="line">-- User实体类 - private List&lt;Video&gt; videos;</span><br><span class="line">user_id int(7)</span><br><span class="line">);</span><br><span class="line">insert into t_video values(1,&#x27;娱乐圈需要整顿&#x27;,now(),10.0,&#x27;http://aistar/001.mp4&#x27;,1);</span><br><span class="line">insert into t_video values(2,&#x27;双减计划&#x27;,now(),20.0,&#x27;http://aistar/002.mp4&#x27;,1);</span><br><span class="line">insert into t_video values(3,&#x27;鼓励三胎&#x27;,now(),30.0,&#x27;http://aistar/003.mp4&#x27;,2);</span><br><span class="line">insert into t_video values(4,&#x27;鼓励一妻多夫&#x27;,now(),40.0,&#x27;http://aistar/004.mp4&#x27;,1);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>二进制数据存储,列的数据类型blob - binary large object - 真正的把图片,视频 - 流 -&gt; 存储到列中 - 不可取</p>
<p>专门搭建一个服务器nginx - 服务器上的资源[图片/视频]都会拥有一个url[统一资源定位器 - 唯一的]</p>
<p><a target="_blank" rel="noopener" href="https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/eb69512d9d6430d865d457ec52eebb51.png?thumb=1&amp;w=400&amp;h=400&amp;f=webp&amp;q=90">https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/eb69512d9d6430d865d457ec52eebb51.png?thumb=1&amp;w=400&amp;h=400&amp;f=webp&amp;q=90</a></p>
</blockquote>
<blockquote>
<p>实际现在推荐的方式是在表中,比如video_url - 存储这个视频对应的它所在服务器的地址即可</p>
</blockquote>
<h2 id="基础的作业"><a href="#基础的作业" class="headerlink" title="基础的作业"></a><strong>基础的作业</strong></h2><blockquote>
<ol>
<li><strong>完成针对t_video表的crud操作</strong> - 交的</li>
</ol>
</blockquote>
<h2 id="级联操作"><a href="#级联操作" class="headerlink" title="级联操作"></a>级联操作</h2><blockquote>
<p>IUserDao.java接口中</p>
<ol>
<li><strong>根据id删除用户,并且把这个用户下的所有的发布的视频全部删除 - 级联删除.</strong></li>
<li><strong>根据id查询用户,如果该用户发布了视频信息,查询这个用户下发布的视频信息 - 级联查询</strong></li>
<li><strong>保存一个用户的同时也保存了这个用户的三个视频信息 - 级联插入</strong></li>
</ol>
</blockquote>
<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><blockquote>
<p>负责发送sql语句的对象 - <strong>Statement语句对象</strong> - 引发sql注入问题 - <strong>是因为参数硬拼接到了sql语句中</strong></p>
<p>sql注入的场景:</p>
<p><strong>username是外部传过来的参数.该参数直接会被拼接到sql语句中.</strong></p>
<p><strong>rs = st.executeQuery(sql);</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"> String sql = <span class="string">&quot;select * from t_user where username=&#x27;&quot;</span>+username+<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>单元测试</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> tech.aistar.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> tech.aistar.model.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: sql注入</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/26 8:45 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlInjectionTest</span> </span>&#123;</span><br><span class="line">    IUserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetByUsername</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// String sql = &quot;select * from t_user where username=&#x27;&quot;+username+&quot;&#x27;&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//username=&#x27;钱枫&#x27; or &#x27;1&#x27;=&#x27;1&#x27;</span></span><br><span class="line">        <span class="comment">//此处实参是表中不存在的数据 - 钱枫</span></span><br><span class="line">        User user = userDao.getByUsername(<span class="string">&quot;钱枫&#x27; or &#x27;1&#x27;=&#x27;1&quot;</span>);<span class="comment">//直接硬拼接到了sql.当然此处的字符串中也有可能包含非法的sql//语句</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//select * from t_user where username=&#x27;钱枫&#x27; or &#x27;1&#x27;=&#x27;1&#x27;;</span></span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="comment">//User&#123;id=1, username=&#x27;admin&#x27;, password=&#x27;123&#x27;, birthday=2021-08-25&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="PrepareStatement-I"><a href="#PrepareStatement-I" class="headerlink" title="PrepareStatement[I]"></a>PrepareStatement[I]</h1><blockquote>
<ol>
<li>预编译语句对象</li>
<li>继承于Statement对象</li>
<li>有效防止sql注入</li>
<li>如何创建<strong>预编译语句对象</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">PreparedStatement <span class="title">prepareStatement</span><span class="params">(String sql)</span></span>;<span class="comment">//利用一条sql构建预编译语句对象</span></span><br><span class="line">此处的sql可能包含一些参数的占位符</span><br><span class="line">              </span><br><span class="line">String sql=<span class="string">&quot;insert into t_video(title,create_date,price,video_url,user_id) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line"><span class="comment">//3-2. 创建了pst对象</span></span><br><span class="line"><span class="comment">//     把带有参数占位符的sql语句已经提前发送到了my-server端进行预编译好了.</span></span><br><span class="line">pst = conn.prepareStatement(sql);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol start="5">
<li>如何发送参数 - <strong>列的类型</strong></li>
</ol>
<p>setInt,setString,setDate,setDouble….</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把参数发送到mysql-server端,然后再由mysql-server端把参数填充到已经预编译好的sql语句</span></span><br><span class="line"><span class="comment">//序号也是从1开始</span></span><br><span class="line">pst.setString(<span class="number">1</span>,video.getTitle());</span><br><span class="line"><span class="comment">//pst.setDate(2,video.getCreateDate());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//关于setDate比较特殊 - java.sql.Date</span></span><br><span class="line"><span class="comment">//但是video.getCreateDate() - java.util.Date</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//java.sql.Date extends java.util.Date</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//void setDate(int parameterIndex, java.sql.Date x)</span></span><br><span class="line"><span class="comment">//处理 - java.util.Date -&gt; 转换成 java.sql.Date</span></span><br><span class="line"><span class="comment">//构造 - Date(long time);//利用毫秒数来构建一个日期对象,long-&gt;Date</span></span><br><span class="line"><span class="comment">//      long getTime();//获取日期的毫秒数;// Date-&gt;long</span></span><br><span class="line"><span class="comment">//pst.setDate(2,new java.sql.Date(video.getCreateDate().getTime()));</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//java.sql.TimeStamp extends java.util.Date</span></span><br><span class="line"><span class="comment">//提供了构造Timestamp(long time);</span></span><br><span class="line">pst.setTimestamp(<span class="number">2</span>,<span class="keyword">new</span> Timestamp(video.getCreateDate().getTime()));</span><br><span class="line"></span><br><span class="line">pst.setDouble(<span class="number">3</span>,video.getPrice());</span><br><span class="line">pst.setString(<span class="number">4</span>,video.getVideoUrl());</span><br><span class="line"><span class="comment">//为什么需要在Video中维护了单个user对象的原因.</span></span><br><span class="line">pst.setInt(<span class="number">5</span>,video.getUser().getId());</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>方法</li>
</ol>
<p><strong>6-1. int executeUpate();</strong></p>
<p><strong>6-2. ResultSet executeQuery();</strong></p>
</blockquote>
<h2 id="PrepareStatement和Statement区别"><a href="#PrepareStatement和Statement区别" class="headerlink" title="PrepareStatement和Statement区别"></a>PrepareStatement和Statement区别</h2><blockquote>
<ol>
<li>PreparedStatement继承自Statement,都是接口</li>
<li>Statement适用于运行<strong>静态 SQL 语句</strong>[参数直接硬拼接到sql语句]。 <strong>Statement</strong> 接口不接受参数。</li>
<li>**PrepareStatement计划多次使用同一条 SQL 语句[适合执行同构的sql]**， PreparedStatement接口运行时接受输入的参数。</li>
<li>PrepareStatement有效防止sql注入</li>
<li>PreparedStatement会<strong>预编译</strong>SQL语句,Statement<strong>每次都会解析/编译</strong>SQL</li>
<li>preStatement 的效率 比 Statement 的效率高</li>
</ol>
</blockquote>
<h2 id="同构sql的场景"><a href="#同构sql的场景" class="headerlink" title="同构sql的场景"></a>同构sql的场景</h2><p><code>PrepareStatement</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">String sql=<span class="string">&quot;insert into t_video(title,create_date,price,video_url,user_id) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提前把sql发送mysql-server预编译</span></span><br><span class="line">pst = connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送参数</span></span><br><span class="line"><span class="keyword">for</span> (Video video : videoList) &#123;</span><br><span class="line">  <span class="comment">//一组参数</span></span><br><span class="line">  <span class="comment">//设置参数</span></span><br><span class="line">  pst.setString(<span class="number">1</span>,video.getTitle());</span><br><span class="line">  pst.setTimestamp(<span class="number">2</span>,<span class="keyword">new</span> Timestamp(video.getCreateDate().getTime()));</span><br><span class="line">  pst.setDouble(<span class="number">3</span>,video.getPrice());</span><br><span class="line">  pst.setString(<span class="number">4</span>,video.getVideoUrl());</span><br><span class="line">  <span class="comment">//为什么需要在Video中维护了单个user对象的原因.</span></span><br><span class="line">  pst.setInt(<span class="number">5</span>,video.getUser().getId());</span><br><span class="line"></span><br><span class="line">  <span class="comment">//发送</span></span><br><span class="line">  pst.executeUpdate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>Statement实现</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">st = conn.createStatement();</span><br><span class="line"><span class="keyword">for</span> (Video video : videoList) &#123;</span><br><span class="line">  String sql = <span class="string">&quot;insert....字符串拼接..&quot;</span>+video.getTitle()+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+video.get...;</span><br><span class="line">  <span class="comment">//Statement每次都会解析/编译SQL</span></span><br><span class="line">  st.executeUpdate(sql); </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="批处理操作"><a href="#批处理操作" class="headerlink" title="批处理操作"></a>批处理操作</h1><blockquote>
<p>比如批量插入 - 即使以后学习了持久层的框架[hibernate,mybatis,mybatis-plus,springdatajpa],但是遇到批量插入,首选的技术jdbc</p>
<p>.效率仍然是最高的.</p>
<p>PrepareStatement关于批处理的api</p>
<ol>
<li>void addBatch();向这个 PreparedStatement对象的一批命令添加一组参数</li>
<li>void clearParameters() 立即清除当前参数值。</li>
<li>void clearBatch();//清空此 <code>Statement</code>对象的当前SQL命令列表</li>
<li>int[] executeBatch();//执行命令列表</li>
</ol>
</blockquote>
<blockquote>
<p><code>需要在url上增加一个配置</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;rewriteBatchedStatements=<span class="keyword">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveListBatch</span><span class="params">(List&lt;Video&gt; videoList)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">Connection connection = <span class="keyword">null</span>;</span><br><span class="line">PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> connection = JdbcUtil.getConnection();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//无论保存多少给视频信息,使用到的是相同的结构的 - 同构的sql语句</span></span><br><span class="line"> String sql=<span class="string">&quot;insert into t_video(title,create_date,price,video_url,user_id) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//提前把sql发送mysql-server预编译</span></span><br><span class="line"> pst = connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//发送参数</span></span><br><span class="line"> <span class="keyword">for</span> (Video video : videoList) &#123;</span><br><span class="line">   <span class="comment">//一组参数</span></span><br><span class="line">   <span class="comment">//设置参数</span></span><br><span class="line">   pst.setString(<span class="number">1</span>,video.getTitle());</span><br><span class="line">   pst.setTimestamp(<span class="number">2</span>,<span class="keyword">new</span> Timestamp(video.getCreateDate().getTime()));</span><br><span class="line">   pst.setDouble(<span class="number">3</span>,video.getPrice());</span><br><span class="line">   pst.setString(<span class="number">4</span>,video.getVideoUrl());</span><br><span class="line">   <span class="comment">//为什么需要在Video中维护了单个user对象的原因.</span></span><br><span class="line">   pst.setInt(<span class="number">5</span>,video.getUser().getId());</span><br><span class="line"></span><br><span class="line">   <span class="comment">//发送</span></span><br><span class="line">   <span class="comment">//缺陷 - 来一个对象 - 一组参数 - 客户端[jdbc代码]-频繁和mysql-server端进行交互 - 发送一组参数</span></span><br><span class="line">   <span class="comment">//pst.executeUpdate();</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//优化 - 同时发送很多组.</span></span><br><span class="line">   <span class="comment">//可以把每个组的参数 - 放入到批处理的列表中.</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//向这个 PreparedStatement对象的一批命令添加一组参数</span></span><br><span class="line">   pst.addBatch();<span class="comment">//意味着此时没有进行发送</span></span><br><span class="line">   count++;<span class="comment">//计数 - 组</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//应该每多少组 - 就得发送一次呢 - 根据具体的业务.</span></span><br><span class="line">   <span class="keyword">if</span>(count==<span class="number">1000</span>)&#123;</span><br><span class="line">     <span class="comment">//把参数发送mysql-server端一次</span></span><br><span class="line">     pst.executeBatch();<span class="comment">//执行批处理的命令列表</span></span><br><span class="line">     <span class="comment">//清空一下命令列表</span></span><br><span class="line">     pst.clearBatch();</span><br><span class="line">     pst.clearParameters();<span class="comment">//立即清除当前参数值。</span></span><br><span class="line">     count=<span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//考虑插入的不是1000的倍数</span></span><br><span class="line"> <span class="keyword">if</span>(count!=<span class="number">0</span>)&#123;</span><br><span class="line">   <span class="comment">//防止漏电了参数</span></span><br><span class="line">   pst.executeBatch();</span><br><span class="line">   pst.clearBatch();</span><br><span class="line">   pst.clearParameters();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"> e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line"> JdbcUtil.close(pst,connection);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="第二层封装"><a href="#第二层封装" class="headerlink" title="第二层封装"></a>第二层封装</h1><ol>
<li>老管说的话,一定都是对的</li>
<li>如果发现老管说错了,请参考第一条.</li>
</ol>
<h2 id="模板设计模式"><a href="#模板设计模式" class="headerlink" title="模板设计模式"></a>模板设计模式</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Connection connection = <span class="keyword">null</span>;</span><br><span class="line">PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">//1.加载驱动,获取连接</span></span><br><span class="line">  connection = JdbcUtil.getConnection();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//个性的</span></span><br><span class="line">  <span class="comment">//String sql=&quot;&quot;;</span></span><br><span class="line">  <span class="comment">//pst = connection.prepareStatement(sql);</span></span><br><span class="line">  </span><br><span class="line">  pst.executeUpdate();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">  JdbcUtil.close(pst,connection);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="JdbcTemplate-自定义jdbc模板工具类"><a href="#JdbcTemplate-自定义jdbc模板工具类" class="headerlink" title="JdbcTemplate - 自定义jdbc模板工具类"></a>JdbcTemplate - 自定义jdbc模板工具类</h2><h1 id="idea配置datasource"><a href="#idea配置datasource" class="headerlink" title="idea配置datasource"></a>idea配置datasource</h1><p><img data-src="/2021/08/31/JDBC%E6%80%BB/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/j03s_jdbc_tech/note/imgs/dv.png" class="lazyload"> </p>
<p><img data-src="/2021/08/31/JDBC%E6%80%BB/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/j03s_jdbc_tech/note/imgs/dm.png" class="lazyload"> </p>
<p><code>选择驱动</code></p>
<p><img data-src="/2021/08/31/JDBC%E6%80%BB/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/j03s_jdbc_tech/note/imgs/driver.png" class="lazyload"> </p>
<p><img data-src="/2021/08/31/JDBC%E6%80%BB/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/j03s_jdbc_tech/note/imgs/dd.png" class="lazyload"> </p>
<p><code>点击apply</code></p>
<p><img data-src="/2021/08/31/JDBC%E6%80%BB/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/j03s_jdbc_tech/note/imgs/index.png" class="lazyload"> </p>
<p><code>db-连接属性</code></p>
<p><img data-src="/2021/08/31/JDBC%E6%80%BB/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/j03s_jdbc_tech/note/imgs/conn.png" class="lazyload"> </p>
<p><code>如果不行</code></p>
<p><img data-src="/2021/08/31/JDBC%E6%80%BB/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/j03s_jdbc_tech/note/imgs/re.png" class="lazyload"> </p>
<h1 id="级联插入"><a href="#级联插入" class="headerlink" title="级联插入"></a>级联插入</h1><blockquote>
<p>插入一个用户的同时,同时插入这个用户的视频信息 - 业务线是不存在.</p>
<ol>
<li>如果视频信息比较多 - 批处理</li>
<li>事务 - 同时成功和同时失败</li>
<li><strong>插入user的时候,怎么拿到刚刚插入的那个主键值[auto_increment]</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为了拿到自增长的主键列的值</span></span><br><span class="line">pst = conn.prepareStatement(sql,Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">         </span><br><span class="line"><span class="comment">//插入一个新的user之后,如何能够拿到刚刚自增长的主键列的值</span></span><br><span class="line"><span class="comment">//一行一列的</span></span><br><span class="line">rsPk = pst.getGeneratedKeys();<span class="comment">//肯定是拿到一个</span></span><br><span class="line">         </span><br><span class="line">Integer insertUserId = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(rsPk.next())&#123;</span><br><span class="line">  insertUserId = rsPk.getInt(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">         </span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><blockquote>
<p>jdbc的事务是和底层的数据是相关的相关的.</p>
<p>jdbc中的事务是默认自动提交的.</p>
<p>jdbc编程中的事务 - 编程性事务 - 控制事务的代码和jdbc代码耦合在一块儿.</p>
<p>未来都是使用的是spring中声明事务.把事务的代码和应用程序的代码分离了.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Connection conn = <span class="keyword">null</span>;</span><br><span class="line">PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = JdbcUtil.getConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">//保证同时成功同时失败</span></span><br><span class="line"><span class="comment">//涉及到很多个sql - 保证事务的原子性 - 同时成功,同时失败.</span></span><br><span class="line"><span class="comment">//设置手动提交</span></span><br><span class="line">conn.setAutoCommit(<span class="keyword">false</span>);<span class="comment">//默认是自动提交的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//手动提交</span></span><br><span class="line">conn.commit();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">//回滚</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">null</span>!=conn)&#123;</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">   conn.rollback();<span class="comment">//回滚</span></span><br><span class="line"> &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">   ex.printStackTrace();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">JdbcUtil.close(pst,conn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="作业-1"><a href="#作业-1" class="headerlink" title="作业"></a>作业</h1><blockquote>
<p><strong>IUserDao.java</strong></p>
<ol>
<li><strong>统计每个用户发布的视频的数量</strong></li>
</ol>
<p><strong>UserDaoImpl.java实现类不要给我写输出语句 - 返回结果.</strong></p>
<ol start="2">
<li>今天代码级联操作 - 理解+敲</li>
<li><strong>多条件组合分页查询</strong></li>
</ol>
<p><strong>2-1. 如果仅仅给定了一个用户名 - 根据用户名进行一个分页查询</strong></p>
<p><strong>2-2. 如果仅仅给定了一个title,那么就是根据title进行模糊分页查询</strong></p>
<p><strong>2-2. 如果username和title同时给了.同时根据这俩个条件[同时成立]进行分页查询.</strong></p>
<p><strong>2-3. 如果俩个条件都不给.那么就是查整个视频表,分页查询.</strong></p>
</blockquote>
<h1 id="DTO"><a href="#DTO" class="headerlink" title="DTO"></a>DTO</h1><blockquote>
<p>DTO - Data transfer object - 数据传输对象.</p>
<p>当内存中的数据没有任何一个实体类可以绑定的时候,那么可以考虑创建第三方实体类,用来作为数据交互的容器 - DTO</p>
<p>DTO对象它是不需要和表和它进行映射的,它只是在内存中进行传输的.</p>
</blockquote>
<h1 id="多条件组合分页查询"><a href="#多条件组合分页查询" class="headerlink" title="多条件组合分页查询"></a>多条件组合分页查询</h1><blockquote>
<p>使用limit语句 - 分页公式:limit (pageNow-1)*pageSize,pageSize</p>
<p><code>分页之后得到的数据</code></p>
<ol>
<li>每页显示的条数 - 手动传入的.</li>
<li>根据条件查询得到的结果的个数 - rows - 总的条数</li>
<li>总的条数/每页显示条数 =&gt; 总的页数</li>
</ol>
<p>  <strong>网页中显示的分页的数据-[手机信息,book信息]</strong></p>
<p><strong>上一页  1 2 3 4 5 6 7 8  下一页    当前页12/30总页</strong></p>
</blockquote>
<h2 id="业务逻辑层-service"><a href="#业务逻辑层-service" class="headerlink" title="业务逻辑层 - service"></a>业务逻辑层 - service</h2><blockquote>
<ol>
<li>数据持久层 - dao - dao接口 - 只负责和db进行交互 - sql语句 - 关注点在”db和数据的crud”</li>
<li>业务逻辑层 - service - service接口 - 不需要和db进行交互,<strong>把dao层交互得到的数据</strong>进行业务逻辑的处理 - 不需要写sql</li>
</ol>
<p>service层需要调用dao层 - service关注点 - “业务逻辑”</p>
<p>最难写的一层就是service层</p>
</blockquote>
<h1 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h1><blockquote>
<p>DataBaseMetaData - 数据库的元数据 - 可以获取数据库的元信息 - url,user,driver,版本号等信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.sql.Connection提供的</span><br><span class="line"><span class="function">DataBaseMetaData <span class="title">getMetaData</span><span class="params">()</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ResultSetMetaData - 结果集元数据 - 可以获取结果集的元信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.day03;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tech.aistar.util.JdbcUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: 结果集元数据</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/27 10:48 上午</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultSetMetaDataDemo</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     Connection conn = <span class="keyword">null</span>;</span><br><span class="line">     PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line">     ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         conn = JdbcUtil.getConnection();</span><br><span class="line">         String sql = <span class="string">&quot;select id,title from t_video&quot;</span>;</span><br><span class="line">         <span class="comment">//可以生成可滚动和/或可更新的ResultSet对象</span></span><br><span class="line">         pst = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//本质上是一个光标,默认是停留在第一行的上方.</span></span><br><span class="line">         rs = pst.executeQuery();</span><br><span class="line"></span><br><span class="line">         <span class="comment">//描述结果集的 - 结果集的元数据[描述数据的数据]</span></span><br><span class="line">         ResultSetMetaData rsmd = rs.getMetaData();</span><br><span class="line">         <span class="comment">//1. 获取查询结果 - 列的个数</span></span><br><span class="line">         <span class="keyword">int</span> cols = rsmd.getColumnCount();</span><br><span class="line"></span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=cols; i++) &#123;</span><br><span class="line">             <span class="comment">//获取列的标题名称 - 下标从1开始</span></span><br><span class="line">             String colName = rsmd.getColumnName(i);</span><br><span class="line">             System.out.print(colName+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         System.out.println();</span><br><span class="line"></span><br><span class="line">         <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">             <span class="comment">//String getString(int i);//可以获取任意类型的数据</span></span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=cols; i++) &#123;</span><br><span class="line">                 System.out.print(rs.getString(i)+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">             &#125;</span><br><span class="line">             System.out.println();</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">     &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">         JdbcUtil.close(rs,pst,conn);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="重新认识ResultSet"><a href="#重新认识ResultSet" class="headerlink" title="重新认识ResultSet"></a>重新认识ResultSet</h2><blockquote>
<p>构建一个可滚动可更新的结果集对象</p>
<ol>
<li>任意定位到具体的行</li>
<li>直接使用rs对象来进行update和delete以及insert操作</li>
</ol>
</blockquote>
<blockquote>
<p>本质上是一个光标,默认是停留在第一行的上方.</p>
<ol>
<li>boolean next();//向下移动一行</li>
<li>boolean absolute(int row);//绝对定位到行</li>
<li>boolean first();//定位到第一行</li>
<li>boolean last();//定位到最后一行</li>
<li>boolean relative(int n);//相对定位</li>
</ol>
</blockquote>
<h3 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.day03;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tech.aistar.util.JdbcUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Result;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: 结果集对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/27 10:34 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultSetDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = JdbcUtil.getConnection();</span><br><span class="line">            String sql = <span class="string">&quot;select * from t_video&quot;</span>;</span><br><span class="line">            <span class="comment">//可以生成可滚动和/或可更新的ResultSet对象</span></span><br><span class="line">            pst = conn.prepareStatement(sql, ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//本质上是一个光标,默认是停留在第一行的上方.</span></span><br><span class="line">            rs = pst.executeQuery();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//绝对定位 - 默认是不支持的</span></span><br><span class="line">            <span class="comment">//Operation not allowed for a result set of type</span></span><br><span class="line">            <span class="comment">//ResultSet.TYPE_FORWARD_ONLY -</span></span><br><span class="line">            <span class="comment">//默认的只有一个向前移动的光标。</span></span><br><span class="line">            <span class="comment">//因此，您只能从第一行到最后一行迭代一次。 可以生成可滚动和/或可更新的ResultSet对象</span></span><br><span class="line">            rs.absolute(<span class="number">3</span>);<span class="comment">//设置成一个可滚动的结果集</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//相对定位</span></span><br><span class="line">            <span class="comment">//rs.relative(-2);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//rs.first();//定位到第一行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//rs.last();//定位到最后一行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//可以直接通过光标来进行update操作和delete操作</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//更新第3行的title - rs.absolute(3)</span></span><br><span class="line">            <span class="comment">//rs.updateString(&quot;title&quot;,&quot;田原&quot;);</span></span><br><span class="line">            <span class="comment">//commit操作</span></span><br><span class="line">            <span class="comment">//rs.updateRow();</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//删除行</span></span><br><span class="line">            rs.deleteRow();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            System.out.println(rs.getString(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtil.close(rs,pst,conn);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h1><h2 id="DriverManager方式缺陷"><a href="#DriverManager方式缺陷" class="headerlink" title="DriverManager方式缺陷"></a>DriverManager方式缺陷</h2><blockquote>
<p>在执行JDBC的增删改查的操作时，如果每一次操作都来一次打开连接，操作，关闭连接，</p>
<p>那么创建和销毁JDBC连接的开销就太大了。为了避免频繁地创建和销毁JDBC连接，我们可以通过连接池（Connection Pool）复用已经创建好的连接。</p>
<p><img data-src="/2021/08/31/JDBC%E6%80%BB/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/j03s_jdbc_tech/note/imgs/dms.png" class="lazyload"> </p>
</blockquote>
<h2 id="连接池选择"><a href="#连接池选择" class="headerlink" title="连接池选择"></a>连接池选择</h2><blockquote>
<p>JDBC连接池有一个标准的接口<code>javax.sql.DataSource</code>，注意这个类位于Java标准库中，但仅仅是接口。要使用JDBC连接池，我们必须选择一个JDBC连接池的实现。常用的JDBC连接池有：</p>
<ul>
<li>HikariCP</li>
<li>C3P0</li>
<li>BoneCP</li>
<li><strong>Druid - 阿里的</strong></li>
<li>dbcp</li>
</ul>
</blockquote>
<h2 id="连接池的基本原理"><a href="#连接池的基本原理" class="headerlink" title="连接池的基本原理"></a>连接池的基本原理</h2><p><strong>数据库连接池的基本思想就是为数据库连接 建立一个“缓冲池”。预先在缓冲池中放入一定数量的连接，当需要建立数据库连接时，只需从“缓冲池”中取出一个，使用完毕之后再放回去</strong>。我们可以通过设定 连接池最大连接数来防止系统无尽的与数据库连接。更为重要的是我们可以通过连接池的管理机制监视数据库的连接的数量?使用情况，为系统开发?测试及性能调 整提供依据。</p>
<h2 id="连接池的工作原理"><a href="#连接池的工作原理" class="headerlink" title="连接池的工作原理"></a>连接池的工作原理</h2><blockquote>
<p>连接池的工作原理主要由三部分组成，分别为连接池的建立、连接池中连接的使用管理、连接池的关闭。</p>
</blockquote>
<blockquote>
<ol>
<li><em><strong>连接池的创建</strong></em></li>
</ol>
<p>一般在系统初始化时，连接池会根据系统配置建立，并在池中创建了几个连接对象，以便使用时能从连接池中获取。<br>连接池中的连接不能随意创建和关闭，这样避免了连接随意建立和关闭造成的系统开销。Java中提供了很多容器类可以方便的构建连接池，例如Vector[线程安全的类]、Stack等。</p>
<ol start="2">
<li><strong>连接池连接的使用管理</strong></li>
</ol>
<p>连接池管理策略是连接池机制的核心，连接池内连接的分配和释放对系统的性能有很大的影响。其管理策略是：<br>当客户请求数据库连接时，首先查看连接池中是否有空闲连接，如果存在空闲连接，则将连接分配给客户使用；如果没有空闲连接，则查看当前所开的连接数是否已经达到最大连接数，如果没达到就重新创建一个连接给请求的客户；如果达到就按设定的最大等待时间进行等待，如果超出最大等待时间，则抛出异常给客户。 当客户释放数据库连接时，先判断该连接的引用次数是否超过了规定值，如果超过就从连接池中删除该连接，否则保留为其他客户服务。该策略保证了数据库连接的有效复用，避免频繁的建立、释放连接所带来的系统资源开销。</p>
<ol start="3">
<li>当应用程序退出时，关闭连接池中所有的连接，释放连接池相关的资源，该过程正好与创建相反</li>
</ol>
</blockquote>
<h2 id="为什么要使用连接池"><a href="#为什么要使用连接池" class="headerlink" title="为什么要使用连接池"></a>为什么要使用连接池</h2><blockquote>
<p>数据库连接是一种关键的有限的昂贵的资源，这一点在多用户的网页应用程序中体现得尤为突出。  一个数据库连接对象均对应一个物理数据库连接，每次操作都打开一个物理连接，使用完都关闭连接，这样造成系统的 性能低下。 数据库连接池的解决方案是在应用程序启动时建立足够的数据库连接，并讲这些连接组成一个连接池(简单说：在一个“池”里放了好多半成品的数据库联接对象)，由应用程序动态地对池中的连接进行申请、使用和释放。对于多于连接池中连接数的并发请求，应该在请求队列中排队等待。并且应用程序可以根据池中连接的使用率，动态增加或减少池中的连接数。 连接池技术尽可能多地重用了消耗内存地资源，大大节省了内存，提高了服务器地服务效率，能够支持更多的客户服务。通过使用连接池，将大大提高程序运行效率，同时，我们可以通过其自身的管理机制来监视数据库连接的数量、使用情况等。</p>
</blockquote>
<h2 id="相关配置-部分"><a href="#相关配置-部分" class="headerlink" title="相关配置-部分"></a>相关配置-部分</h2><blockquote>
<ol>
<li><strong>maxActive</strong> 连接池支持的最大连接数，这里取值为20，表示同时最多有20个数据库连接。一般把maxActive设置成可能的并发量就行了设 0 为没有限制。</li>
<li><strong>maxIdle</strong> 连接池中最多可空闲maxIdle个连接 ，这里取值为20，表示即使没有数据库连接时依然可以保持20空闲的连接，而不被清除，随时处于待命状态。设 0 为没有限制。</li>
<li><strong>minIdle</strong> 连接池中最小空闲连接数，当连接数少于此值时，连接池会创建连接来补充到该值的数量</li>
<li><strong>initialSize</strong> 初始化连接数目 </li>
<li><strong>maxWait</strong> 连接池中连接用完时,新的请求等待时间,毫秒，这里取值-1，表示无限等待，直到超时为止，也可取值9000，表示9秒后超时。超过时间会出错误信息</li>
</ol>
</blockquote>
<h1 id="手撸连接池"><a href="#手撸连接池" class="headerlink" title="手撸连接池"></a>手撸连接池</h1><h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><blockquote>
<ol>
<li>静态代理</li>
<li>动态代理 - jdk动态代理[Spring底层默认的代理模式]以及cglib代理</li>
</ol>
<p>jdk动态代理只能代理接口</p>
</blockquote>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><blockquote>
<p>给dao层中的每个方法添加日志输出.</p>
</blockquote>
<h2 id="不使用代理"><a href="#不使用代理" class="headerlink" title="不使用代理"></a>不使用代理</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.proxy.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示:</span></span><br><span class="line"><span class="comment">         //日志记录是与业务无关的代码</span></span><br><span class="line"><span class="comment">        //1. 业务无关代码和业务相关代码耦合在一块儿.造成dao层/service层方法比较臃肿</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        //2. 日志有一定的格式.如果哪天日志格式,日志记录的内容发生了改变.需要修改所有</span></span><br><span class="line"><span class="comment">        //   出现日志的程序代码的.</span></span><br><span class="line"><span class="comment">        //3. 日志记录的功能维护性比较差</span></span><br><span class="line"><span class="comment"> 							  </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/27 2:19 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherDaoImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//与业务无关的方法 - 日志记录 - 核心方法调用之前日志输出</span></span><br><span class="line">        System.out.println(<span class="string">&quot;log-before...&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//核心&quot;业务&quot;的代码</span></span><br><span class="line">        System.out.println(<span class="string">&quot;jdbc-insert&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//日志记录 - 核心方法调用之后日志输出</span></span><br><span class="line">        System.out.println(<span class="string">&quot;log-after...&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;log-before...&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//核心&quot;业务&quot;的代码</span></span><br><span class="line">        System.out.println(<span class="string">&quot;jdbc-del:&quot;</span>+id);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;log-after...&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h2><blockquote>
<p>在程序的编译期间,手动编写静态代理类 =&gt; 并且在编译期就得生成这个静态代理类.</p>
<p>优点:将核心的代码和非核心的代码[日志代码]进行了分离.不会导致核心的代码显示得比较臃肿了.</p>
<p>缺点 </p>
<ol>
<li>程序中会出现大量的静态代理类[增加了维护成本].</li>
<li>如果日志格式需要改变.需要修改很多静态代理类中的代码的.对于静态代理类而言的.违背了软件的”开闭原则”.</li>
</ol>
</blockquote>
<blockquote>
<p>被代理对象 - 房东</p>
<p>代理对象 - 中介</p>
<p>代理对象和被代理对象都应该去实现同一个接口 - 在实际应用的时候,是使用代理对象去调用接口的方法!</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.proxy.demo02;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: 编译期间生成的一个静态代理类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 代理对象和被代理对象都应该去实现同一个接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/27 2:28 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherDaoImplProxy</span> <span class="keyword">implements</span> <span class="title">ITeacherDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TeacherDaoImplProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//构建一个代理对象的时候,里面会立即初始化被代理的对象类[原始对象]</span></span><br><span class="line">        <span class="keyword">this</span>.teacherDao = <span class="keyword">new</span> TeacherDaoImpl();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//&quot;中介卖房的时候吹牛的话&quot;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;log-before&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        teacherDao.save();<span class="comment">//原始对象的核心的业务</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;log-after&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;log-before&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        teacherDao.delById(<span class="number">10</span>);<span class="comment">//原始对象的核心的方法</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;log-after&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><blockquote>
<ol>
<li>不需要在编译期间手动编写代理类.</li>
<li>是在程序的运行期间,反射创建代理对象.</li>
<li><strong>jdk动态代理技术只能代理接口.</strong></li>
<li>总结:使用代理对象去调用方法应该是比你原始对象去调用方法的功能更加强大.</li>
</ol>
</blockquote>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.proxy.demo03;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: 动态代理 - 代理任何接口的</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/27 2:48 下午</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"> <span class="comment">//jdk动态代理技术只能代理接口</span></span><br><span class="line"> <span class="keyword">private</span> Object obj;<span class="comment">//被代理的原始对象</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">ProxyHandler</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.obj=obj;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * invoke方法何时被调用?</span></span><br><span class="line"><span class="comment">     * 当使用代理对象调用被代理对象中的方法的时候[save,del]</span></span><br><span class="line"><span class="comment">     * 会自动执行invoke方法.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">     * 如果调用的是ITeacherDao接口中的save方法</span></span><br><span class="line"><span class="comment">     * proxy -&gt; 该接口的代理</span></span><br><span class="line"><span class="comment">     * method -&gt; save方法对应的反射的Method实例</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy 程序在运行的过程中生成的那个代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method 当前正在调用的接口中的那个方法对应的反射的Method实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args 被调用的方法的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;log-before&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">     <span class="comment">//反射调用方法</span></span><br><span class="line">     Object result = method.invoke(obj,args);</span><br><span class="line"></span><br><span class="line">     System.out.println(<span class="string">&quot;log-after&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="使用第三方连接池"><a href="#使用第三方连接池" class="headerlink" title="使用第三方连接池"></a>使用第三方连接池</h1><blockquote>
<p>连接池[实现类]本身就是jdk提供的java.sql.DataSource接口的具体的实现类[BasicDataSource].</p>
<p>连接池本身就是属于一个昂贵的重量级的对象,不要轻易去关闭它.</p>
<p>整个应用程序中,一个连接池对应一个db数据库 - 连接池叫做数据源.<strong>保证连接池的单例.</strong></p>
</blockquote>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><blockquote>
<ol>
<li>导入jar</li>
<li>连接池的配置文件 - 配置参数建议是放在配置文件中统一进行管理的.</li>
<li>db.properties</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统初始化的时候,连接池中的可用的连接的初始的个数</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="string">3</span></span><br><span class="line"><span class="comment"># 连接池中最小空闲连接数,当连接数少于此值时，连接池会创建连接来补充到该值的数量</span></span><br><span class="line">   </span><br><span class="line"><span class="attr">minIdle</span>=<span class="string">5</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment"># 连接池中最多可空闲maxIdle个连接 ，</span></span><br><span class="line"><span class="comment"># 这里取值为20，表示即使没有数据库连接时依然可以保持20空闲的连接，</span></span><br><span class="line"><span class="comment"># 而不被清除，随时处于待命状态。设 0 为没有限制。</span></span><br><span class="line"><span class="attr">maxIdle</span>=<span class="string">15</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment"># 连接池支持的最大连接数，</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="string">15</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment"># 连接池中连接用完时,新的请求等待时间,毫秒</span></span><br><span class="line"><span class="comment"># 1. 当新的请求到达,并且连接池中的连接已经到达maxActive值,连接池是不会分配连接给这个用户的.</span></span><br><span class="line"><span class="comment">#    那么这个用户就会在等待队列中[等待有没有被使用的连接被释放出来 - 新的空闲连接]</span></span><br><span class="line"><span class="comment">#    如果超过maxWait -&gt; 抛出一个已经超时的错误.</span></span><br><span class="line"><span class="attr">maxWait</span>=<span class="string">5000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol start="4">
<li>编写连接池类 - &gt; 单例的.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbcp.BasicDataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 本类用来演示: 连接池[俩个jar]设置参数而已</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span>: 2021/8/27 3:51 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PoolUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> PoolUtil instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BasicDataSource basicDataSource;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">PoolUtil</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//进行一些连接池的配置</span></span><br><span class="line">        basicDataSource = <span class="keyword">new</span> BasicDataSource();</span><br><span class="line">        basicDataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/j03s?useSSL=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true&quot;</span>);</span><br><span class="line">        basicDataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        basicDataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置参数</span></span><br><span class="line">        basicDataSource.setInitialSize(Integer.valueOf(DBPropUtil.getValue(<span class="string">&quot;initialSize&quot;</span>)));</span><br><span class="line">        basicDataSource.setMinIdle(Integer.valueOf(DBPropUtil.getValue(<span class="string">&quot;minIdle&quot;</span>)));</span><br><span class="line">        basicDataSource.setMaxIdle(Integer.valueOf(DBPropUtil.getValue(<span class="string">&quot;maxIdle&quot;</span>)));</span><br><span class="line">        basicDataSource.setMaxActive(Integer.valueOf(DBPropUtil.getValue(<span class="string">&quot;maxActive&quot;</span>)));</span><br><span class="line">        basicDataSource.setMaxWait(Long.valueOf(DBPropUtil.getValue(<span class="string">&quot;maxWait&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PoolUtil <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==instance)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (PoolUtil.class)&#123;<span class="comment">//&quot;类锁&quot;</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">null</span>==instance)&#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> PoolUtil();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 获取连接</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> basicDataSource.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>使用连接池来获取连接</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">conn = PoolUtil.getInstance().getConnection();</span><br><span class="line">    </span><br><span class="line"><span class="comment">//拿到的是一个Connection接口的代理对象</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">//class org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper</span></span><br><span class="line"><span class="comment">//conn.getClass();</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">//原始对象conn.close();//销毁掉了...</span></span><br><span class="line">conn.close();<span class="comment">//关闭</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">//代理对象在调用close();//自动执行invoke方法</span></span><br><span class="line"><span class="comment">//method - close方法的Metthod实例</span></span><br><span class="line"><span class="comment">//proxy - conn</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">  <span class="comment">//到底是应该销毁还是应该把这根连接放回到连接池中,让别的请求继续使用呢???</span></span><br><span class="line">     </span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">     </span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="DB设计之后"><a href="#DB设计之后" class="headerlink" title="DB设计之后"></a>DB设计之后</h1><blockquote>
<p>mybatis框架 - 进入到前端 - 设计项目页面了.</p>
</blockquote>
<blockquote>
<p>组长分配任务 - &gt; 组员 - &gt; 写sql脚本</p>
<ol>
<li>DDL - 建表语句</li>
<li>Insert语句 - 模拟数据 - 尽量真实.</li>
</ol>
</blockquote>
<h1 id="jdbc拓展"><a href="#jdbc拓展" class="headerlink" title="jdbc拓展"></a>jdbc拓展</h1><blockquote>
<ol>
<li><em><strong>复习反射技术</strong></em>+动态代理</li>
<li>实体类的设计+业务层service</li>
<li>为学习mybatis作一个铺垫.</li>
<li>强调下项目中鼓励使用单表查询</li>
</ol>
</blockquote>
<h2 id="jdbc缺陷"><a href="#jdbc缺陷" class="headerlink" title="jdbc缺陷"></a>jdbc缺陷</h2><blockquote>
<ol>
<li>涉及到查询语句 - 手动封装的过程 - 麻烦</li>
</ol>
<p>持久层的框架 - Hibernate全自动的ORM框架 - 可以实现完全的<strong>自动封装</strong>的过程.</p>
<p>Mybatis半自动的ORM框架 - 查询的结果 - 有的需要手动封装,有的<strong>可以自动封装</strong>.</p>
<p>框架 - 为了解决某一领域里的问题而提供的一套解决方案.</p>
<ol start="2">
<li>sql语句会硬编码到了程序中了.java代码和sql语句耦合在一块儿了.不利于后期的sql语句的优化</li>
</ol>
<p>如果后期需要对sql进行优化,还需要对java代码重新编译 - 重新打包 - 重新部署.</p>
</blockquote>
<h2 id="实体类的设计"><a href="#实体类的设计" class="headerlink" title="实体类的设计"></a>实体类的设计</h2><blockquote>
<p>开发中严格按照这个要求.</p>
<ol>
<li>表名要么就和类名保持一致,要么就使用统一的前缀.</li>
<li><strong>列名-属性名高度保持一致-全部小写以及多个单词一定采用匈牙利命名xxx_yyy_zzz</strong></li>
<li><code>尤为重要的 - 对象之间的关系不再是采用之前的那样的强耦合的关系呢!</code></li>
</ol>
</blockquote>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">drop table t_user;</span><br><span class="line">create table t_user(</span><br><span class="line">	id int(7) primary key auto_increment,</span><br><span class="line">  username varchar(20) unique not null,</span><br><span class="line">  password varchar(20) not null,</span><br><span class="line">  birthday date</span><br><span class="line">);</span><br><span class="line">insert into t_user values(1,&#x27;admin&#x27;,&#x27;123&#x27;,now());</span><br><span class="line">insert into t_user values(2,&#x27;tom&#x27;,&#x27;123&#x27;,now());</span><br><span class="line"></span><br><span class="line">drop table t_video;</span><br><span class="line">create table t_video(</span><br><span class="line">	id int(7) primary key auto_increment,</span><br><span class="line">  title varchar(20) not null,</span><br><span class="line">  create_date datetime,</span><br><span class="line">  price double(7,2),</span><br><span class="line">  video_url varchar(120),</span><br><span class="line">	user_id int(7)</span><br><span class="line">);</span><br><span class="line">insert into t_video values(1,&#x27;娱乐圈需要整顿&#x27;,now(),10.0,&#x27;http://aistar/001.mp4&#x27;,1);</span><br><span class="line">insert into t_video values(2,&#x27;双减计划&#x27;,now(),20.0,&#x27;http://aistar/002.mp4&#x27;,1);</span><br><span class="line">insert into t_video values(3,&#x27;鼓励三胎&#x27;,now(),30.0,&#x27;http://aistar/003.mp4&#x27;,2);</span><br><span class="line">insert into t_video values(4,&#x27;鼓励一妻多夫&#x27;,now(),40.0,&#x27;http://aistar/004.mp4&#x27;,1);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>实体类设计</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String password;</span><br><span class="line">  <span class="keyword">private</span> Date birthday;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//不需要进行视频信息的集合的维护...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Video</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String title;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Date createDate;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Double price;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String videoUrl;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//表中的外键是什么,此处就写什么.</span></span><br><span class="line">  <span class="keyword">private</span> Integer userId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO... 对象之间的绑定操作应该如何进行???</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h2><blockquote>
<p><strong>根据用户的id查询用户信息,如果该用户具有视频信息一并加载出来</strong></p>
<p><code>根据id级联删除</code></p>
<p>之前级联操作</p>
<ol>
<li>方式一:使用了嵌套查询-在dao层的一个方法中写了俩条sql.</li>
<li>方式二:在dao层的一个方法中写了一个关联查询.</li>
</ol>
<p>绑定的代码-<strong>user.setVideoList(videos);</strong></p>
</blockquote>
<blockquote>
<p>实际的开发中尽量不要多表查询.如果出现三个表关联查询 - 性能低下了.</p>
<p>每条sql语句可以被灵活的去复用了.</p>
<p>分表操作 - 单表有利于后期的维护的.</p>
</blockquote>
<h3 id="单表的解决方案"><a href="#单表的解决方案" class="headerlink" title="单表的解决方案"></a>单表的解决方案</h3><blockquote>
<ol>
<li>先根据用户id查询出用户出来</li>
<li>根据用户id[user_id]去查询视频表</li>
<li>需要使用第三方dto对象来建立User和Video的一个关系.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UserVo-绑定用户和这个用户的视频信息的.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第一种方式 - 采用继承的写法 - 不推荐使用继承的.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserVo</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Video&gt; videoList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserVo</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> User user;</span><br><span class="line">   <span class="keyword">private</span> List&lt;Video&gt; videoList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol start="4">
<li>制定业务层接口 - 数据的绑定</li>
</ol>
</blockquote>
<h1 id="回顾动态代理"><a href="#回顾动态代理" class="headerlink" title="回顾动态代理"></a>回顾动态代理</h1><blockquote>
<p>jdk动态代理只能代理接口.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.proxy.demo03;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">private</span> Object obj;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyHandler</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj=obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">//proxy - teacherDao对应的代理对象</span></span><br><span class="line">      <span class="comment">//method-代理对象正在调用的那个方法的method实例,del - Method m = c.getDeclaredMethod(&quot;del&quot;);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;log-before&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//反射调用方法</span></span><br><span class="line">        Object result = method.invoke(obj,args);<span class="comment">//核心的业务.原始obj</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;log-after&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//单元测试</span></span><br><span class="line"><span class="comment">//jdk动态代理只能代理接口.</span></span><br><span class="line">ITeacherDao teacherDao = <span class="keyword">new</span> TeacherDaoImpl();</span><br><span class="line"></span><br><span class="line">ProxyHandler hander = <span class="keyword">new</span> ProxyHandler(teacherDao);</span><br><span class="line"></span><br><span class="line"><span class="comment">//构建代理对象</span></span><br><span class="line">ITeacherDao proxy = (ITeacherDao) Proxy.newProxyInstance(teacherDao.getClass().getClassLoader()</span><br><span class="line">                                                         ,teacherDao.getClass().getInterfaces(),hander);</span><br><span class="line"></span><br><span class="line"><span class="comment">//代理对象调用目标接口中的方法</span></span><br><span class="line">proxy.del(<span class="number">10</span>);<span class="comment">//invoke方法</span></span><br><span class="line"></span><br><span class="line">proxy.save();</span><br><span class="line"></span><br><span class="line"><span class="comment">//总结出来就是</span></span><br><span class="line"><span class="comment">//代理对象去调用原始接口中的目标方法的时候,自动执行invoke方法</span></span><br><span class="line"><span class="comment">//invoke方法中除了核心的方法的调用[反射],还有可能有额外的动作.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="手撸连接池-1"><a href="#手撸连接池-1" class="headerlink" title="手撸连接池"></a>手撸连接池</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Connection - 接口 - 才可以使用jdk动态代理技术</span><br><span class="line">目标方法 - commit(),close();</span><br><span class="line"></span><br><span class="line">connProxy - conn连接对象的代理对象</span><br><span class="line">  </span><br><span class="line">核心的业务方法conn.close();</span><br><span class="line"></span><br><span class="line">connProxy.close();<span class="comment">//自动调用invoke - 判断,到底是应该把连接销毁conn.close();还是应该把这根连接进行回收,放回到连接池中.</span></span><br><span class="line"></span><br><span class="line">原始对象 - 房东</span><br><span class="line">  			- 租房</span><br><span class="line">        - 卖房</span><br><span class="line">  </span><br><span class="line">代理对象 - 中介  </span><br><span class="line">  </span><br><span class="line">客户访问房源 - 调用 - [中介吹牛<span class="number">1</span>,吹牛<span class="number">2</span>,吹牛<span class="number">3</span> ,    房东的.房子[反射调用]    , ......] - invoke</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.aistar.mypools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tech.aistar.util.JdbcUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本类用来演示: 简化的连接池</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: success</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021/8/30 3:10 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSource</span> </span>&#123;<span class="comment">//单例的</span></span><br><span class="line">    <span class="comment">//最大的连接</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> maxActive = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化的连接数量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> initialSize = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//正在被使用的连接</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> currSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&quot;连接池&quot; - 集合实现的.</span></span><br><span class="line">    <span class="comment">//重量级的对象 - 只要被加载一次,并且整个内存中的实例只有1个.</span></span><br><span class="line">    <span class="comment">// 不能随意创建和销毁 - 比较耗时.</span></span><br><span class="line">    <span class="keyword">public</span> LinkedList&lt;Connection&gt; pools = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span>  MyDataSource instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//私有化构造</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//初始化一些拥有的连接放入到&quot;连接池中去&quot;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; initialSize; i++) &#123;</span><br><span class="line">            pools.add(createConnection());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyDataSource <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span>==instance)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (MyDataSource.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">null</span>==instance)&#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> MyDataSource();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">createConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//jdbc代码...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//代理对象</span></span><br><span class="line">        Connection connProxy = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Connection conn = JdbcUtil.getConnection();<span class="comment">//原始接口</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//conn的代理对象</span></span><br><span class="line">            connProxy = (Connection) Proxy.newProxyInstance(conn.getClass().getClassLoader(), conn.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="comment">//只要使用代理对象调用目标接口Connection接口的任何方法-都会执行invoke</span></span><br><span class="line">                    <span class="comment">//close,commit,rollback ....</span></span><br><span class="line">                    Object result = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="comment">//改变close方法的功能 - 未必是直接销毁conn,有可能是放回到pools中</span></span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">&quot;close&quot;</span>.equals(method.getName()) &amp;&amp; currSize&lt;=maxActive)&#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;===放回到连接池中===&quot;</span>);</span><br><span class="line">                        currSize--;<span class="comment">//当前正在被使用到的连接</span></span><br><span class="line">                        pools.add(conn);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;close&quot;</span>.equals(method.getName()) &amp;&amp; currSize&gt;maxActive)&#123;</span><br><span class="line">                        <span class="comment">//initialSize - 最大的空闲</span></span><br><span class="line">                        System.out.println(<span class="string">&quot;===真正的去销毁连接===&quot;</span>);</span><br><span class="line">                        currSize--;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="keyword">null</span>!=conn)&#123;</span><br><span class="line">                            conn.close();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">//commit,rollback...</span></span><br><span class="line">                        result = method.invoke(conn,args);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回的是代理对象</span></span><br><span class="line">        <span class="keyword">return</span> connProxy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供一个方法来获取连接</span></span><br><span class="line">    <span class="comment">//目的 - 从连接池中得到一根连接</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//1. 如果连接池中有可能的连接,那么就直接从&quot;pools&quot;中直接返回一个</span></span><br><span class="line">        <span class="comment">//2. 保证多线程环境下,不能有俩个线程争抢到同一个connection</span></span><br><span class="line">        <span class="keyword">synchronized</span> (pools)&#123;</span><br><span class="line">            <span class="keyword">if</span>(pools.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;===直接从pools中取===&quot;</span>);</span><br><span class="line">                currSize++;</span><br><span class="line">                <span class="comment">//说明连接池中有可用的连接</span></span><br><span class="line">                <span class="comment">//集合中删除一个,删除的这个连接返回出去</span></span><br><span class="line">                <span class="keyword">return</span> pools.removeLast();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(currSize&lt;=maxActive)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;===init初始化的连接已经用完了===&quot;</span>);</span><br><span class="line">                <span class="comment">//pools中初始的连接已经用光了.</span></span><br><span class="line">                currSize++;</span><br><span class="line">                <span class="comment">//隐含的条件 - 拿到之后.需要把这根连接放连接池中 - 有可能.</span></span><br><span class="line">                <span class="keyword">return</span> createConnection();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;sorry,您需要等待了!已经超过连接池最大活动数了!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Connection conn1 = MyDataSource.getInstance().getConnection();</span><br><span class="line"></span><br><span class="line">        Connection conn2 = MyDataSource.getInstance().getConnection();</span><br><span class="line"></span><br><span class="line">        Connection conn3 = MyDataSource.getInstance().getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//代理对象调用 - 放回到连接池中</span></span><br><span class="line">        Connection conn4 = MyDataSource.getInstance().getConnection();</span><br><span class="line"></span><br><span class="line">        conn4.close();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// conn3.close();</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;当前正在使用的连接的个数:&quot;</span>+MyDataSource.getInstance().currSize);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;当前连接池中存在的可用的连接的个数:&quot;</span>+MyDataSource.getInstance().pools.size());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//System.out.println(MyDataSource.getInstance().pools.size());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//conn1.close();//不能直接傻瓜式去关闭了,也有可能是放回到连接池中.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//conn1.close();//自动找到invoke方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        conn1.setAutoCommit(false);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        conn1.commit();</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





















</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">覃烽</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/08/31/JDBC%E6%80%BB/">http://example.com/2021/08/31/JDBC%E6%80%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com">LuckyFeng的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JDBC/">JDBC    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>mybatis学习(一)</span></div></a></div><div class="next-post pull_right"><a href="/2021/08/31/part06-%E8%A7%86%E5%9B%BE%E5%92%8Climit/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>part06_视图和limit</span></div></a></div></nav></div></div><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2023 By 覃烽</div><div class="framework-info"><span>驱动 </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="/js/third-party/canvas-nest.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script></body></html>