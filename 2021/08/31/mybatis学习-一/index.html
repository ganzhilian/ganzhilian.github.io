<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>mybatis学习(一) | LuckyFeng的博客</title><meta name="description" content="mybatis学习(一)"><meta name="keywords" content="mybatis"><meta name="author" content="覃烽"><meta name="copyright" content="覃烽"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="mybatis学习(一)"><meta name="twitter:description" content="mybatis学习(一)"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="og:type" content="article"><meta property="og:title" content="mybatis学习(一)"><meta property="og:url" content="http://example.com/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/"><meta property="og:site_name" content="LuckyFeng的博客"><meta property="og:description" content="mybatis学习(一)"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://example.com/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/"><link rel="prev" title="spring" href="http://example.com/2021/09/22/spring/"><link rel="next" title="JDBC总" href="http://example.com/2021/08/31/JDBC%E6%80%BB/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'false',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">LuckyFeng的博客</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 框架</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="https://s3.bmp.ovh/imgs/2021/08/537218da738c4aaa.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">37</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">10</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 框架</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Mybatis%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Mybatis执行原理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Mybatis%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">Mybatis框架简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Mybatis%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Mybatis环境的搭建</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%AF%BC%E5%85%A5jar"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">导入jar</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">配置文件</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#mybatis%E7%9A%84%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text">mybatis的主配置文件</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%A0%B8%E5%BF%83API"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">核心API</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#SqlSessionFactoryBuilder"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">SqlSessionFactoryBuilder</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#SqlSessionFactory"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">SqlSessionFactory</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#SqlSession"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">SqlSession</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">传统的开发方式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">映射文件配置注意点</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E9%85%8D%E7%BD%AE%E5%88%AB%E5%90%8D"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text">配置别名</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#parameterType%E5%92%8CresultType"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text">parameterType和resultType</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#resultType"><span class="toc_mobile_items-number">6.3.</span> <span class="toc_mobile_items-text">resultType</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#resultMap"><span class="toc_mobile_items-number">6.4.</span> <span class="toc_mobile_items-text">resultMap</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#selectOne%E5%92%8CselectList%E5%8C%BA%E5%88%AB"><span class="toc_mobile_items-number">6.5.</span> <span class="toc_mobile_items-text">selectOne和selectList区别</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E7%BB%83%E4%B9%A0IVedioDao"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">练习IVedioDao</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%8C%88%E7%89%99%E5%88%A9-lt-gt-%E5%B0%8F%E9%A9%BC%E5%B3%B0%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">匈牙利&lt;-&gt;小驼峰自动映射</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%8D%A0%E4%BD%8D%E7%AC%A6%E5%8C%BA%E5%88%AB-%E5%92%8C"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">占位符区别$和#</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%8F%82%E6%95%B0%E5%90%8D"><span class="toc_mobile_items-number">8.1.</span> <span class="toc_mobile_items-text">参数名</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Mapper%E4%BB%A3%E7%90%86%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">Mapper代理开发方式</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%89%96%E6%9E%90Mapper%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%BA%95%E5%B1%82"><span class="toc_mobile_items-number">9.1.</span> <span class="toc_mobile_items-text">剖析Mapper动态代理底层</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text">输入参数类型</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E8%BF%94%E5%9B%9E%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc_mobile_items-number">10.1.</span> <span class="toc_mobile_items-text">返回参数类型</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%8A%A8%E6%80%81SQL%E8%AF%AD%E5%8F%A5"><span class="toc_mobile_items-number">11.</span> <span class="toc_mobile_items-text">动态SQL语句</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#if%E6%A0%87%E7%AD%BE"><span class="toc_mobile_items-number">11.1.</span> <span class="toc_mobile_items-text">if标签</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#where%E6%A0%87%E7%AD%BE"><span class="toc_mobile_items-number">11.2.</span> <span class="toc_mobile_items-text">where标签</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#set%E6%A0%87%E7%AD%BE"><span class="toc_mobile_items-number">11.3.</span> <span class="toc_mobile_items-text">set标签</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#foreach%E6%A0%87%E7%AD%BE"><span class="toc_mobile_items-number">11.4.</span> <span class="toc_mobile_items-text">foreach标签</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc_mobile_items-number">11.4.1.</span> <span class="toc_mobile_items-text">练习</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc_mobile_items-number">12.</span> <span class="toc_mobile_items-text">注解开发</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#sql%E7%89%87%E6%AE%B5"><span class="toc_mobile_items-number">13.</span> <span class="toc_mobile_items-text">sql片段</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#resultMap-%E7%BB%A7%E6%89%BF%E6%80%A7"><span class="toc_mobile_items-number">13.1.</span> <span class="toc_mobile_items-text">resultMap - 继承性</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%97%A5%E5%BF%97%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc_mobile_items-number">14.</span> <span class="toc_mobile_items-text">日志的配置</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#SLF4J%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc_mobile_items-number">14.1.</span> <span class="toc_mobile_items-text">SLF4J日志框架</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="toc_mobile_items-number">14.2.</span> <span class="toc_mobile_items-text">配置文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E6%97%A5%E5%BF%97%E7%9A%84%E6%98%BE%E7%A4%BA%E7%BA%A7%E5%88%AB"><span class="toc_mobile_items-number">14.3.</span> <span class="toc_mobile_items-text">日志的显示级别</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%8A%A0%E8%BD%BDone%E7%9A%84%E4%B8%80%E6%96%B9"><span class="toc_mobile_items-number">15.</span> <span class="toc_mobile_items-text">加载one的一方</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E6%90%93%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc_mobile_items-number">15.1.</span> <span class="toc_mobile_items-text">搓的方式</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#association"><span class="toc_mobile_items-number">16.</span> <span class="toc_mobile_items-text">association</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#resultMap-1"><span class="toc_mobile_items-number">16.1.</span> <span class="toc_mobile_items-text">resultMap</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc_mobile_items-number">17.</span> <span class="toc_mobile_items-text">延迟加载</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F-%E6%8E%A8%E8%8D%90"><span class="toc_mobile_items-number">17.1.</span> <span class="toc_mobile_items-text">第一种方式 - 推荐</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F-mybatis%E7%89%B9%E6%80%A7"><span class="toc_mobile_items-number">17.2.</span> <span class="toc_mobile_items-text">第二种方式 - mybatis特性</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%8A%A0%E8%BD%BDmany%E7%9A%84%E4%B8%80%E6%96%B9"><span class="toc_mobile_items-number">18.</span> <span class="toc_mobile_items-text">加载many的一方</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#collection"><span class="toc_mobile_items-number">18.1.</span> <span class="toc_mobile_items-text">collection</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc_mobile_items-number">19.</span> <span class="toc_mobile_items-text">分页查询</span></a></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mybatis%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">Mybatis执行原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mybatis%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">Mybatis框架简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mybatis%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">Mybatis环境的搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5jar"><span class="toc-number">3.1.</span> <span class="toc-text">导入jar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mybatis%E7%9A%84%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.1.</span> <span class="toc-text">mybatis的主配置文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83API"><span class="toc-number">4.</span> <span class="toc-text">核心API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SqlSessionFactoryBuilder"><span class="toc-number">4.1.</span> <span class="toc-text">SqlSessionFactoryBuilder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SqlSessionFactory"><span class="toc-number">4.2.</span> <span class="toc-text">SqlSessionFactory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SqlSession"><span class="toc-number">4.3.</span> <span class="toc-text">SqlSession</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">传统的开发方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">6.</span> <span class="toc-text">映射文件配置注意点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%88%AB%E5%90%8D"><span class="toc-number">6.1.</span> <span class="toc-text">配置别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parameterType%E5%92%8CresultType"><span class="toc-number">6.2.</span> <span class="toc-text">parameterType和resultType</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resultType"><span class="toc-number">6.3.</span> <span class="toc-text">resultType</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resultMap"><span class="toc-number">6.4.</span> <span class="toc-text">resultMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#selectOne%E5%92%8CselectList%E5%8C%BA%E5%88%AB"><span class="toc-number">6.5.</span> <span class="toc-text">selectOne和selectList区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0IVedioDao"><span class="toc-number">7.</span> <span class="toc-text">练习IVedioDao</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%88%E7%89%99%E5%88%A9-lt-gt-%E5%B0%8F%E9%A9%BC%E5%B3%B0%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84"><span class="toc-number">7.1.</span> <span class="toc-text">匈牙利&lt;-&gt;小驼峰自动映射</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%A0%E4%BD%8D%E7%AC%A6%E5%8C%BA%E5%88%AB-%E5%92%8C"><span class="toc-number">8.</span> <span class="toc-text">占位符区别$和#</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%90%8D"><span class="toc-number">8.1.</span> <span class="toc-text">参数名</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mapper%E4%BB%A3%E7%90%86%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc-number">9.</span> <span class="toc-text">Mapper代理开发方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%96%E6%9E%90Mapper%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%BA%95%E5%B1%82"><span class="toc-number">9.1.</span> <span class="toc-text">剖析Mapper动态代理底层</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.</span> <span class="toc-text">输入参数类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.1.</span> <span class="toc-text">返回参数类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A8%E6%80%81SQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">11.</span> <span class="toc-text">动态SQL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#if%E6%A0%87%E7%AD%BE"><span class="toc-number">11.1.</span> <span class="toc-text">if标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#where%E6%A0%87%E7%AD%BE"><span class="toc-number">11.2.</span> <span class="toc-text">where标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set%E6%A0%87%E7%AD%BE"><span class="toc-number">11.3.</span> <span class="toc-text">set标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#foreach%E6%A0%87%E7%AD%BE"><span class="toc-number">11.4.</span> <span class="toc-text">foreach标签</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">11.4.1.</span> <span class="toc-text">练习</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-number">12.</span> <span class="toc-text">注解开发</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E7%89%87%E6%AE%B5"><span class="toc-number">13.</span> <span class="toc-text">sql片段</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#resultMap-%E7%BB%A7%E6%89%BF%E6%80%A7"><span class="toc-number">13.1.</span> <span class="toc-text">resultMap - 继承性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">14.</span> <span class="toc-text">日志的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SLF4J%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-number">14.1.</span> <span class="toc-text">SLF4J日志框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="toc-number">14.2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%9A%84%E6%98%BE%E7%A4%BA%E7%BA%A7%E5%88%AB"><span class="toc-number">14.3.</span> <span class="toc-text">日志的显示级别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BDone%E7%9A%84%E4%B8%80%E6%96%B9"><span class="toc-number">15.</span> <span class="toc-text">加载one的一方</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%93%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">15.1.</span> <span class="toc-text">搓的方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#association"><span class="toc-number">16.</span> <span class="toc-text">association</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#resultMap-1"><span class="toc-number">16.1.</span> <span class="toc-text">resultMap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">17.</span> <span class="toc-text">延迟加载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F-%E6%8E%A8%E8%8D%90"><span class="toc-number">17.1.</span> <span class="toc-text">第一种方式 - 推荐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F-mybatis%E7%89%B9%E6%80%A7"><span class="toc-number">17.2.</span> <span class="toc-text">第二种方式 - mybatis特性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BDmany%E7%9A%84%E4%B8%80%E6%96%B9"><span class="toc-number">18.</span> <span class="toc-text">加载many的一方</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#collection"><span class="toc-number">18.1.</span> <span class="toc-text">collection</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">19.</span> <span class="toc-text">分页查询</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="post-info"><div id="post-title"><div class="posttitle">mybatis学习(一)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-08-31<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2022-02-10</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/mybatis/">mybatis</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon" aria-hidden="true"></i><span>字数总计: </span><span class="word-count">9.8k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon" aria-hidden="true"></i><span>阅读时长: 44 分钟</span><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="Mybatis执行原理"><a href="#Mybatis执行原理" class="headerlink" title="Mybatis执行原理"></a>Mybatis执行原理</h1><p><img data-src="https://s3.bmp.ovh/imgs/2021/09/9a473e963528f593.png" class="lazyload"></p>
<h1 id="Mybatis框架简介"><a href="#Mybatis框架简介" class="headerlink" title="Mybatis框架简介"></a>Mybatis框架简介</h1><blockquote>
<ol>
<li>官方学习文档 - <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></li>
<li>属于主流的持久层[和db交互的层,负责和db打交道]框架,不负责业务操作.只会涉及到sql语句的编写.</li>
<li>属于ORM[对象关系映射 - 表和实体类息息相关的关系]框架,ORM是一个思想.ORM框架就是这个思想的”实现者”</li>
<li>Mybatis是属于半自动的ORM框架 - MyBatis 免除了<em><strong>几乎</strong></em>所有的 JDBC 代码以及设置参数和获取结果集的工作.</li>
</ol>
<p>复杂的查询那么仍然是需要手动进行映射的[列-属性]</p>
<ol start="5">
<li>Mybatis底层是基于jdbc代码的.</li>
<li><strong>mybatis前身叫ibatis</strong></li>
</ol>
</blockquote>
<p><strong>自己对mybatis的理解: 本质就是通过使用简单的xml方式将数据库中的数据转化为java对象, 只需要关心底层的sql语句, 避免了</strong> <strong>JDBC 代码和手动设置参数以及获取结果集.</strong></p>
<p>原文網址：<a target="_blank" rel="noopener" href="https://kknews.cc/code/eb3pjeq.html">https://kknews.cc/code/eb3pjeq.html</a>  </p>
<h1 id="Mybatis环境的搭建"><a href="#Mybatis环境的搭建" class="headerlink" title="Mybatis环境的搭建"></a>Mybatis环境的搭建</h1><blockquote>
<p>使用框架之前,都是需要经过繁琐的配置的.除了SpringBoot[简化了配置]</p>
<p>最新版本 - 3.5.7 - <a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p>
</blockquote>
<h2 id="导入jar"><a href="#导入jar" class="headerlink" title="导入jar"></a>导入jar</h2><blockquote>
<ol>
<li>项目的根目录下新建一个lib目录 - 用来存放第三方jar</li>
</ol>
<p>1-1. mysql-connector-java-8.0.25.jar - mysql的驱动jar包</p>
<p>1-2. mybatis-3.5.7.jar - mybatis的jar包</p>
<ol start="2">
<li>选中jar - 右击 - Add As Library … - 把这俩个jar添加到类路径中[classpath]</li>
</ol>
</blockquote>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><blockquote>
<p>框架的配置文件要么是properties文件[支持,优先级是最高的],本次课程中推荐使用的配置文件是<strong>xml文件[结构比较清晰]</strong></p>
<p>等待后面学习SpringBoot - 推荐使用的配置文件是yml文件[yarn语法]</p>
</blockquote>
<blockquote>
<ol>
<li><strong>mybatis的主配置文件</strong></li>
<li>mapper的映射文件 - 存储项目中的所有的sql语句.sql语句和应用程序进行了分离,方便sql语句的维护.</li>
</ol>
</blockquote>
<h3 id="mybatis的主配置文件"><a href="#mybatis的主配置文件" class="headerlink" title="mybatis的主配置文件"></a>mybatis的主配置文件</h3><blockquote>
<p>mybatis的运行时环境,mybatis框架能够被使用的前提是肯定会去读取这个配置文件.配置了该框架运行所有应该具备的信息.</p>
<p>推荐 - 放在src的根目录下mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">     <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">     <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--    配置环境的选择 - 开发环境下的配置</span></span><br><span class="line"><span class="comment">         环境 - 开发环境,测试环境,产品上线[部署]环境</span></span><br><span class="line"><span class="comment">         通过default的属性值来指定哪种环境会生效</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- mybatis的事务就是采用jdbc事务[由底层的数据库驱动决定了]--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--配置数据源的 - POOLED - 相当于连接池 - 使用mybatis自带的--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/j03s?useSSL=true<span class="symbol">&amp;amp;</span>characterEncoding=utf8<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai&quot;</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="核心API"><a href="#核心API" class="headerlink" title="核心API"></a>核心API</h1><h2 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h2><blockquote>
<p>仅仅只会使用到一次.</p>
<p><strong>SqlSessionFactory build(InputStream in);</strong></p>
<p>功能:读取xml的字节输入流来构建一个重量级的对象SqlSessionFactory - 相当于jdbc<strong>数据源</strong>对象[BasicDataSource].</p>
</blockquote>
<h2 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h2><blockquote>
<p>重量级的对象 - 不能随意创建多个或者随意销毁 - 耗时间 - 占内存 - <strong>单例</strong></p>
<p>一旦被创建就应该在应用的运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例</p>
</blockquote>
<blockquote>
<p>SqlSession openSession();//获取Session对象</p>
</blockquote>
<h2 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a>SqlSession</h2><blockquote>
<p>作用:负责和db进行CRUD操作.</p>
</blockquote>
<blockquote>
<p>与db进行一次会话 - 一次连接.相当于JDBC中的Connection对象.但是比jdbc多出缓存的功能.</p>
<p><strong>SqlSession=Connection[db连接] + Cache[默认的一级缓存];</strong></p>
<p>SqlSession 的实例不是线程安全的，因此是不能被共享的.每个线程都应该有它自己的 SqlSession 实例.</p>
<p>session应该是一个局部变量</p>
<p><code>回顾java知识点</code></p>
<p>当线程执行到方法的时候,就会在本地开辟一块区域 - 线程栈[独占的]</p>
</blockquote>
<h1 id="传统的开发方式"><a href="#传统的开发方式" class="headerlink" title="传统的开发方式"></a>传统的开发方式</h1><blockquote>
<ol>
<li>db设计 - 实体类设计  - User - Video</li>
<li>编写IUserDao接口,UserDaoImpl接口实现类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User user = session.selectOne(<span class="string">&quot;userMapper.get&quot;</span>,username);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写映射文件 - tech/aistar/mapperxml - 目录下存储所有的映射文件user-mapper.xml</li>
<li>需要在mybatis-config.xml文件中配置映射文件.</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--        指定映射文件的配置路径--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;tech/aistar/mapperxml/user-mapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>剖析</code></p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> session = MybatisUtil.getSession();</span><br><span class="line">观察MybatisUtil - 读取了mybatis-config.xml文件 - user-mapper.xml</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span> 俩个文件都被加载到JVM内存了.</span><br><span class="line">user-mapper.xml里面的信息都是在内存中了.</span><br><span class="line">namespace=<span class="string">&quot;userMapper&quot;</span>应该是唯一的,一个namespace应该是对应唯一的映射文件.</span><br><span class="line">因为项目中可能有多个映射文件.Map&lt;String,xml映射对象&gt; maps</span><br><span class="line">maps.put(<span class="string">&quot;userMapper&quot;</span>,xml文件对应的映射对象);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span> selectOne(namespace.sql语句id值)</span><br><span class="line">XMl映射对象 变量 = maps.get(<span class="string">&quot;userMapper&quot;</span>);<span class="comment">//精准的定位到它自己的xml文件.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.</span> xml文件中会有很多个sql标签 - 每个sql标签的id应该是唯一的.精确拿到select标签</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5.</span> 定位到select标签之后,利用xml的dom解析技术 - 标签体中的内容/标签属性的值</span><br><span class="line">select * from t_user where username = #&#123;username&#125;</span><br><span class="line">resultType=<span class="string">&quot;tech.aistar.model.entity.User&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6.</span> Class&lt;?&gt; c = Class.forName(<span class="string">&quot;tech.aistar.model.entity.User&quot;</span>);</span><br><span class="line">	 jdbc编程步骤</span><br><span class="line">pst = conn.preparedStatement(sql);</span><br><span class="line">T t = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">判断参数个数 - 发送参数</span><br><span class="line">  </span><br><span class="line">rs=pst.executeQuery();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="映射文件配置注意点"><a href="#映射文件配置注意点" class="headerlink" title="映射文件配置注意点"></a>映射文件配置注意点</h1><h2 id="配置别名"><a href="#配置别名" class="headerlink" title="配置别名"></a>配置别名</h2><blockquote>
<p>在mybatis-config.xml文件中进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    配置类型的别名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        一个一个配置--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;typeAlias type=&quot;tech.aistar.model.entity.User&quot; alias=&quot;u&quot;&gt;&lt;/typeAlias&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--        对项目中的实体类统计进行配置--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        扫包 - 实体类所在的包,默认分配一个别名,就是类型的小写--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;tech.aistar.model&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="parameterType和resultType"><a href="#parameterType和resultType" class="headerlink" title="parameterType和resultType"></a>parameterType和resultType</h2><blockquote>
<ol>
<li>parameterType对应的参数的类型</li>
</ol>
<p>内置对象的对象类型或者基本类型,可以简便的使用这些类型的别名,底层进行了特殊的处理了</p>
<p>比如:parameterType=”java.lang.String”可以简单表示为parameterType=”string”</p>
<p>比如:long-&gt;long或者别名_long.</p>
<p>①推荐如果遇到的基本数据类型,直接写它名称本身即可int-&gt;int</p>
<p>②如果遇到包装类型,推荐写它对应的基本类型的名称[就是包装类型的别名]</p>
<p>③内置的对象类型,诸如String,Date,Map,List等可以写它们的别名[这些单词的小写字母]</p>
</blockquote>
<h2 id="resultType"><a href="#resultType" class="headerlink" title="resultType"></a>resultType</h2><blockquote>
<p>只有select标签才需要指定resultType属性</p>
<p>mybatis什么时候才能够实现自动映射的效果 - <strong>一定是查询出来的列名和实体类属性名高度保持一致</strong></p>
<p>或者出来的列名是一个合法的<strong>匈牙利命名 - 实体类属性的小驼峰.</strong></p>
<p>绑定失败的场景:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">resultType=&quot;user&quot;</span><br><span class="line"></span><br><span class="line">select id uid,username uname,password,birthday from t_user where username = #&#123;username&#125;</span><br><span class="line"></span><br><span class="line">User&#123;id=null, username=&#x27;null&#x27;, password=&#x27;654321&#x27;, birthday=Thu Aug 26 00:00:00 CST 2021&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><code>为什么绑定失败</code></p>
<p>JdbcNBUtil.java</p>
<p>String colName = rsmd.getColumnName(i);<br>colName = changeColName(colName);//防止出现了匈牙利 -&gt; 小驼峰</p>
<p>Field f = c.getDeclaredField(colName);//冒出来了uid和冒出uname - &gt; 反射找不到对应的Field或者Method</p>
<p>说明了id和username并没有通过反射设置值.</p>
</blockquote>
<h2 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h2><blockquote>
<p>应用场景一: 当<strong>查询的列值不能自动映射</strong>/绑定实体类的属性的时候,需要通过resultMap来进行一一绑定.</p>
<p>mybatis有些场景下还是需要手动绑定 - 半自动的ORM框架.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    手动映射--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;get_map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        主键列映射--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        普通列映射--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;get&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;get_map&quot;</span>&gt;</span></span><br><span class="line">select id uid,username uname,password,birthday from t_user where username = #&#123;username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>剖析一下手动绑定的过程</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">type=<span class="string">&quot;tech.aistar.model.pojo.user&quot;</span> - &gt; </span><br><span class="line">  </span><br><span class="line">Class&lt;?&gt; c = Class.forName(type);</span><br><span class="line">T t = (T)c.newInstance();</span><br><span class="line"></span><br><span class="line">result标签的顺序可以随机的 -&gt; 说明底层 - rs要么根据列的序号取[从<span class="number">1</span>开始],可以根据列的名称去取.</span><br><span class="line">  </span><br><span class="line"><span class="function">Object <span class="title">getObject</span><span class="params">(String columnLabel)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line"></span><br><span class="line">Object uname = rs.getObject(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line"></span><br><span class="line">property=<span class="string">&quot;username&quot;</span> -&gt; 底层<span class="string">&quot;setUsername&quot;</span>-&gt;</span><br><span class="line">Method m = c.getDeclaredMethod(<span class="string">&quot;setUsername&quot;</span>);</span><br><span class="line">m.invoke(t,uname);<span class="comment">//反射调用setter方法.</span></span><br><span class="line"></span><br><span class="line">加入method找不到 - Field f = c.getDeclaredField(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">f.set(t,uname);</span><br><span class="line"></span><br><span class="line">如果property=<span class="string">&quot;属性值&quot;</span>找不到任何一个对应的method或者field -&gt; 直接抛出 </span><br><span class="line">There is no setter <span class="keyword">for</span> property named <span class="string">&#x27;usernames&#x27;</span> in <span class="string">&#x27;class tech.aistar.model.entity.User&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="selectOne和selectList区别"><a href="#selectOne和selectList区别" class="headerlink" title="selectOne和selectList区别"></a>selectOne和selectList区别</h2><blockquote>
<ol>
<li>selectOne - 负责加载唯一的一条数据 - 返回的是一个单个对象</li>
<li>selectList - 负责加载多条数据,<strong>返回一个集合</strong></li>
<li>如果在必须使用selectList,不小心使用到了selectOne.那么就会抛出异常</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.exceptions.TooManyResultsException: <span class="function">Expected one <span class="title">result</span> <span class="params">(or <span class="keyword">null</span>)</span> to be returned by <span class="title">selectOne</span><span class="params">()</span>, but found: 5</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="练习IVedioDao"><a href="#练习IVedioDao" class="headerlink" title="练习IVedioDao"></a>练习IVedioDao</h1><blockquote>
<p>完成crud</p>
<p>卡壳 - 不断抛出异常 - “思考代码-<strong>表面-背后</strong>“ - “理解规则 - 遵守规则” + 规范</p>
<p><strong>idea中配置映射文件的模板</strong></p>
<p><img data-src="/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/mybatis-j03s/note/t.png" class="lazyload"> </p>
</blockquote>
<p><code>点击+</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img data-src="/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/mybatis-j03s/note/tm.png" class="lazyload"> </p>
<p><code>点击apply - ok</code></p>
<h2 id="匈牙利-lt-gt-小驼峰自动映射"><a href="#匈牙利-lt-gt-小驼峰自动映射" class="headerlink" title="匈牙利&lt;-&gt;小驼峰自动映射"></a>匈牙利&lt;-&gt;小驼峰自动映射</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;video&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">   select * from t_video where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">列 - video_url  user_id create_date</span><br><span class="line">-- 设置失败.</span><br><span class="line">Video&#123;id=20, title=&#x27;国庆节2&#x27;, createDate=null, price=100.0, videoUrl=&#x27;null&#x27;, userId=null&#125;</span><br><span class="line"></span><br><span class="line">第一种处理方式 - 使用resultMap手动进行映射.</span><br><span class="line"></span><br><span class="line">第二种处理方式 - 针对db中的特殊的匈牙利的命名方式 - 在mybatis-config.xml文件中进行设置.</span><br><span class="line"><span class="comment">&lt;!--    开启小驼峰命名映射--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="占位符区别-和"><a href="#占位符区别-和" class="headerlink" title="占位符区别$和#"></a>占位符区别$和#</h1><blockquote>
<p>建议完善俩者区别</p>
<ol>
<li>$ - 产生了sql注入的问题,把参数直接硬拼接到了sql中.相当于Statement</li>
<li>井号</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#&#123;参数&#125; - 相当于PreparedStatement,占位符?</span><br><span class="line">              </span><br><span class="line"><span class="comment">//提前将这条语句进行预编译的. #&#123;title&#125; -&gt; ?</span></span><br><span class="line"><span class="comment">//设置参数和发送参数</span></span><br><span class="line">select * from t_video where title = #&#123;title&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p><code> 剖析</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from t_video where title = #&#123;title&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">select * from t_video where title = $&#123;title&#125;</span><br><span class="line"></span><br><span class="line">报错的原因:控制台已经后台生成的sql显示出来了 -  </span><br><span class="line">select * from t_video where title = 国庆节<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">把findByTile中的字符串参数直接硬拼接到了sql语句的占位符号去了.</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByTitle</span><span class="params">()</span></span>&#123;</span><br><span class="line">  videoDao.findByTitle(<span class="string">&quot;国庆节2&quot;</span>).forEach(e-&gt; System.out.println(e));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非要使用$&#123;title&#125;</span></span><br><span class="line">select * from t_video where title = <span class="string">&#x27;$&#123;title&#125;&#x27;</span></span><br><span class="line">videoDao.findByTitle(<span class="string">&quot;国庆节2&quot;</span>).forEach(e-&gt; System.out.println(e));</span><br><span class="line">select * from t_video where title = <span class="string">&#x27;国庆节2&#x27;</span>;<span class="comment">//ok</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//产生sql注入了</span></span><br><span class="line">videoDao.findByTitle(<span class="string">&quot;国庆节3&#x27; or&#x27;1&#x27;=&#x27;1&quot;</span>).forEach(e-&gt; System.out.println(e));</span><br><span class="line"></span><br><span class="line">select * from t_video where title = <span class="string">&#x27;国庆节3&#x27;</span> or<span class="string">&#x27;1&#x27;</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="参数名"><a href="#参数名" class="headerlink" title="参数名"></a>参数名</h2><blockquote>
<ol>
<li><strong>如果是简单类型 - 单个参数[String,包装类型,基本数据类型]</strong></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#&#123;参数名&#125;和$&#123;参数名&#125;是任意取名称的.</span><br><span class="line">            </span><br><span class="line">id=#&#123;ttt&#125;   id=#&#123;value&#125;  id=#&#123;id&#125;</span><br><span class="line">            </span><br><span class="line">本质上#&#123;参数&#125; 等同于 ? </span><br><span class="line">              </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;video&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select * from t_video where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">推荐使用使用的是#&#123;value&#125;或者#&#123;方法的参数的名称&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol start="2">
<li>如果是自定义的对象类型 - 不能瞎写</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">   insert into t_video values(#&#123;id&#125;,#&#123;title&#125;,#&#123;createDate&#125;,#&#123;price&#125;,#&#123;videoUrl&#125;,#&#123;userId&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="Mapper代理开发方式"><a href="#Mapper代理开发方式" class="headerlink" title="Mapper代理开发方式"></a>Mapper代理开发方式</h1><blockquote>
<p>底层使用到的技术就是<strong>动态代理</strong> - <strong>动态代理技术[JDK]来在程序的运行期间来生成Mapper接口的实现类.</strong></p>
<p>传统的方式还是需要手动写接口的实现类的.</p>
<p>遵守Mapper开发方式的规范 - 一定要遵守</p>
</blockquote>
<blockquote>
<ol>
<li><strong>创建包tech.aistar.mapper - 存放mapper接口</strong></li>
</ol>
<p>替代之前的dao包下的dao接口</p>
<ol start="2">
<li>制定Mapper接口 - <strong>接口的命名必须要规范 - 实体类名Mapper</strong> - 比如UserMapper,VideoMapper</li>
<li>在Mapper接口中制定方法</li>
<li>一定是在Mapper接口所在的包下新建Mapper接口对应的映射文件,并且映射文件的命名一定要和它对应的Mapper接口的命名高度保持一致 - <strong>映射文件的存放位置以及映射文件的命名</strong></li>
<li>每个映射文件都会指定唯一的一个<strong>namespace</strong>属性值 - 一定是这个映射文件对应的那个<strong>Mapper接口的全限定名</strong>.</li>
<li>select,update,insert,delete这些<strong>sql标签的id属性的值</strong>一定要和mapper<strong>接口中的方法的名称</strong>高度保持一致.</li>
<li>mybatis-config.xml文件中配置映射文件.</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--        指定映射文件的配置路径--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--        &lt;mapper resource=&quot;tech/aistar/mapperxml/user-mapper.xml&quot;&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--        &lt;mapper resource=&quot;tech/aistar/mapperxml/video-mapper.xml&quot;&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line">         </span><br><span class="line">   <span class="comment">&lt;!--        直接扫接口 - 一个一个扫--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--        &lt;mapper class=&quot;tech.aistar.mapper.UserMapper&quot;&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--        &lt;mapper class=&quot;tech.aistar.mapper.VideoMapper&quot;&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line">         </span><br><span class="line">   <span class="comment">&lt;!--        直接扫所有mapper接口所在的目录即可--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;tech.aistar.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol start="8">
<li>mapper编程步骤</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 获取连接</span></span><br><span class="line"><span class="comment">//2. 获取Mapper接口对象</span></span><br><span class="line"><span class="comment">//3. 接口对象调用方法</span></span><br><span class="line"><span class="comment">//4. commit/关闭连接</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="剖析Mapper动态代理底层"><a href="#剖析Mapper动态代理底层" class="headerlink" title="剖析Mapper动态代理底层"></a>剖析Mapper动态代理底层</h2><blockquote>
<p>搞懂为什么需要遵守这些规范</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//底层如何构建UserMapper的实现</span></span><br><span class="line"><span class="comment">//userMapper是一个代理对象</span></span><br><span class="line"><span class="comment">//此处仅仅是在获取Mapper</span></span><br><span class="line">UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"><span class="comment">//为什么就可以顺利执行到那条sql</span></span><br><span class="line"><span class="comment">//代理对象调用方法的时候,比如会走invoke - 必然会想办法找到id=&quot;findAll&quot;的sql语句</span></span><br><span class="line"><span class="comment">//比如findAll方法-&gt;对应的Method实例传入invoke-&gt;String getName();//-&gt;findAll-&gt;sql语句id属性值</span></span><br><span class="line">List&lt;User&gt; userList = userMapper.findAll();</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol>
<li>第一步</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br></pre></td></tr></table></figure>

<p><code>build方法</code></p>
<ol start="2">
<li>查看build方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//inputStream - mybatis-config.xml的字节输入流</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">build</span><span class="params">(InputStream inputStream)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.build((InputStream)inputStream, (String)<span class="keyword">null</span>, (Properties)<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>继续查看this.build方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取mybatis-config.xml 返回一个SqlSessionFactory重量级的对象</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">build</span><span class="params">(InputStream inputStream, String environment, Properties properties)</span> </span>&#123;</span><br><span class="line">  SqlSessionFactory var5;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//功能 - 就是xml解析</span></span><br><span class="line">    XMLConfigBuilder parser = <span class="keyword">new</span> XMLConfigBuilder(inputStream, environment, properties);</span><br><span class="line">    <span class="comment">//mybatis-config.xml文件中的内容解析出来 - Java内存可以拿到xml文件中的配置信息了</span></span><br><span class="line">    <span class="comment">//拿到配置信息之后进行下一个动作</span></span><br><span class="line">    var5 = <span class="keyword">this</span>.build(parser.parse());</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception var14) &#123;</span><br><span class="line">    <span class="keyword">throw</span> ExceptionFactory.wrapException(<span class="string">&quot;Error building SqlSession.&quot;</span>, var14);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    ErrorContext.instance().reset();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      inputStream.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException var13) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> var5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>this.build(<strong>parser.parse()</strong>);</li>
</ol>
<p><code>参数parser.parse()</code>从mybatis-config.xml文件中解析出来的每个数据</p>
<p>把xml配置文件中的解析出来的数据封装到了<strong>Configuration对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">build</span><span class="params">(Configuration config)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> DefaultSqlSessionFactory(config);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">大概观察一下Configuration类</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> Environment environment;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> mapUnderscoreToCamelCase;</span><br><span class="line">&#125;</span><br><span class="line">&lt;setting name=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">xml解析-mapUnderscoreToCamelCase - <span class="keyword">true</span></span><br><span class="line"><span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> - Field - 反射设置对象字段中的mapUnderscoreToCamelCase值为<span class="keyword">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>以上4步 - mybatis-config.xml -&gt; Configuration对象</p>
</blockquote>
<blockquote>
<ol start="5">
<li>继续观察Configuration类内部</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Mapper注册机 - 想象成Mapper的容器 - 工厂</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> MapperRegistry mapperRegistry;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Configuration</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="comment">//底层肯定是使用到了Configuration对象.映射文件的信息也是配置在了mybatis-config.xml文件中的.</span></span><br><span class="line">   <span class="keyword">this</span>.mapperRegistry = <span class="keyword">new</span> MapperRegistry(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>定位到MapperRegistry</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, MapperProxyFactory&lt;?&gt;&gt; knownMappers = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回一个单个Mapper接口的动态代理对象</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(Class&lt;T&gt; type, SqlSession sqlSession)</span> </span>&#123;</span><br><span class="line">  MapperProxyFactory&lt;T&gt; mapperProxyFactory = (MapperProxyFactory)<span class="keyword">this</span>.knownMappers.get(type);</span><br><span class="line">  <span class="keyword">if</span> (mapperProxyFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Type &quot;</span> + type + <span class="string">&quot; is not known to the MapperRegistry.&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//动态代理</span></span><br><span class="line">      <span class="keyword">return</span> mapperProxyFactory.newInstance(sqlSession);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var5) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Error getting mapper instance. Cause: &quot;</span> + var5, var5);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="7">
<li>回到Configuration类中</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要把所有的配置的mapper接口全部用动态代理技术构建好之后放入到 knownMappers</span></span><br><span class="line"><span class="comment">//观察的方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMappers</span><span class="params">(String packageName)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.mapperRegistry.addMappers(packageName);</span><br><span class="line"> &#125;</span><br><span class="line">         </span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">addMapper</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.mapperRegistry.addMapper(type);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">分别代表mybatis-config.xml文件中关于映射的配置的俩种方式</span><br><span class="line"> <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--        &lt;mapper class=&quot;tech.aistar.mapper.UserMapper&quot;&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;mapper class=&quot;tech.aistar.mapper.VideoMapper&quot;&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line">         </span><br><span class="line"><span class="comment">&lt;!--        直接扫所有mapper接口所在的目录即可--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;tech.aistar.mapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>扫包</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMappers</span><span class="params">(String packageName)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.addMappers(packageName, Object.class);</span><br><span class="line">&#125;</span><br><span class="line">继续观察<span class="keyword">this</span>.<span class="function">addMappers</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMappers</span><span class="params">(String packageName, Class&lt;?&gt; superType)</span> </span>&#123;</span><br><span class="line">  ResolverUtil&lt;Class&lt;?&gt;&gt; resolverUtil = <span class="keyword">new</span> ResolverUtil();</span><br><span class="line">  resolverUtil.find(<span class="keyword">new</span> IsA(superType), packageName);</span><br><span class="line">  Set&lt;Class&lt;? extends Class&lt;?&gt;&gt;&gt; mapperSet = resolverUtil.getClasses();</span><br><span class="line">  Iterator var5 = mapperSet.iterator();</span><br><span class="line">         </span><br><span class="line">  <span class="keyword">while</span>(var5.hasNext()) &#123;</span><br><span class="line">    Class&lt;?&gt; mapperClass = (Class)var5.next();</span><br><span class="line">    <span class="comment">//把配置的包下的所有的接口的全限定名 -&gt; 接口的Class实例</span></span><br><span class="line">    <span class="keyword">this</span>.addMapper(mapperClass);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>继续this.addMapper(mapperClass)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">addMapper</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (type.isInterface()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.hasMapper(type)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Type &quot;</span> + type + <span class="string">&quot; is already known to the MapperRegistry.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">         </span><br><span class="line">    <span class="keyword">boolean</span> loadCompleted = <span class="keyword">false</span>;</span><br><span class="line">         </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//重点的需要在第八步分析的代码</span></span><br><span class="line">      <span class="keyword">this</span>.knownMappers.put(type, <span class="keyword">new</span> MapperProxyFactory(type));</span><br><span class="line">      MapperAnnotationBuilder parser = <span class="keyword">new</span> MapperAnnotationBuilder(<span class="keyword">this</span>.config, type);</span><br><span class="line">      parser.parse();</span><br><span class="line">      loadCompleted = <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!loadCompleted) &#123;</span><br><span class="line">        <span class="keyword">this</span>.knownMappers.remove(type);</span><br><span class="line">      &#125;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>5~7 - mybatis-config.xml中的关于映射文件的配置 - 底层是如何处理的 - 存储所有的Mapper接口</p>
<p>Map&lt;Class<?>, MapperProxyFactory<?>&gt; knownMappers = new HashMap();</p>
</blockquote>
<blockquote>
<ol start="8">
<li>观察this.knownMappers.put(type, new MapperProxyFactory(type));</li>
</ol>
<p>定位到了MapperProxyFactory类中了 - 负责构建每个Mapper接口的代理对象 <strong>- MapperProxy</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">         </span><br><span class="line"><span class="keyword">package</span> org.apache.ibatis.binding;</span><br><span class="line">         </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.binding.MapperProxy.MapperMethodInvoker;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line">         </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperProxyFactory</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//每个具体的Mapper接口的class类型</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; mapperInterface;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Method, MapperMethodInvoker&gt; methodCache = <span class="keyword">new</span> ConcurrentHashMap();</span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapperProxyFactory</span><span class="params">(Class&lt;T&gt; mapperInterface)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mapperInterface = mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Class&lt;T&gt; <span class="title">getMapperInterface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Method, MapperMethodInvoker&gt; <span class="title">getMethodCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.methodCache;</span><br><span class="line">    &#125;</span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> T <span class="title">newInstance</span><span class="params">(MapperProxy&lt;T&gt; mapperProxy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(<span class="keyword">this</span>.mapperInterface.getClassLoader(), <span class="keyword">new</span> Class[]&#123;<span class="keyword">this</span>.mapperInterface&#125;, mapperProxy);</span><br><span class="line">    &#125;</span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">(SqlSession sqlSession)</span> </span>&#123;</span><br><span class="line">        MapperProxy&lt;T&gt; mapperProxy = <span class="keyword">new</span> MapperProxy(sqlSession, <span class="keyword">this</span>.mapperInterface, <span class="keyword">this</span>.methodCache);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.newInstance(mapperProxy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol start="9">
<li>核心 - 找了MapperProxy动态代理对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperProxy</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">InvocationHandler</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SqlSession sqlSession;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; mapperInterface;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Method, MapperProxy.MapperMethodInvoker&gt; methodCache;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapperProxy</span><span class="params">(SqlSession sqlSession, Class&lt;T&gt; mapperInterface, Map&lt;Method, MapperProxy.MapperMethodInvoker&gt; methodCache)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSession = sqlSession;</span><br><span class="line">        <span class="keyword">this</span>.mapperInterface = mapperInterface;</span><br><span class="line">        <span class="keyword">this</span>.methodCache = methodCache;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> Object.class.equals(method.getDeclaringClass()) ? method.invoke(<span class="keyword">this</span>, args) : <span class="keyword">this</span>.cachedInvoker(method).invoke(proxy, method, args, <span class="keyword">this</span>.sqlSession);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Throwable var5) &#123;</span><br><span class="line">              <span class="keyword">throw</span> ExceptionUtil.unwrapThrowable(var5);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>invoke方法 - 什么时候会被调用的??? - 当使用代理对象去调用原始对象中的方法的时候.</p>
<p>List<user> userList = userMapper.findAll();//invoke</user></p>
<ol start="10">
<li>分析invoke中的<strong>this.cachedInvoker(method)</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MapperProxy.<span class="function">MapperMethodInvoker <span class="title">cachedInvoker</span><span class="params">(Method method)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (MapperProxy.MapperMethodInvoker)MapUtil.computeIfAbsent(<span class="keyword">this</span>.methodCache, method, (m) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (m.isDefault()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> privateLookupInMethod == <span class="keyword">null</span> ? <span class="keyword">new</span> MapperProxy.DefaultMethodInvoker(<span class="keyword">this</span>.getMethodHandleJava8(method)) : <span class="keyword">new</span> MapperProxy.DefaultMethodInvoker(<span class="keyword">this</span>.getMethodHandleJava9(method));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InstantiationException | InvocationTargetException | NoSuchMethodException | IllegalAccessException var4) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(var4);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="comment">//有效代码 - new MapperMethod(this.mapperInterface, method, this.sqlSession.getConfiguration())</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> MapperProxy.PlainMethodInvoker(<span class="keyword">new</span> MapperMethod(<span class="keyword">this</span>.mapperInterface, method, <span class="keyword">this</span>.sqlSession.getConfiguration()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException var4) &#123;</span><br><span class="line">            Throwable cause = var4.getCause();</span><br><span class="line">            <span class="keyword">throw</span> (Throwable)(cause == <span class="keyword">null</span> ? var4 : cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="11">
<li>new MapperMethod(this.mapperInterface, method, this.sqlSession.getConfiguration())</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MapperMethod</span><span class="params">(Class&lt;?&gt; mapperInterface, Method method, Configuration config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.command = <span class="keyword">new</span> MapperMethod.SqlCommand(config, mapperInterface, method);</span><br><span class="line">        <span class="keyword">this</span>.method = <span class="keyword">new</span> MapperMethod.MethodSignature(config, mapperInterface, method);</span><br><span class="line">    &#125;</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">execute</span><span class="params">(SqlSession sqlSession, Object[] args)</span> </span>&#123;</span><br><span class="line">        Object result;</span><br><span class="line">        Object param;</span><br><span class="line">        <span class="keyword">switch</span>(<span class="keyword">this</span>.command.getType()) &#123;</span><br><span class="line">        <span class="keyword">case</span> INSERT:</span><br><span class="line">            param = <span class="keyword">this</span>.method.convertArgsToSqlCommandParam(args);</span><br><span class="line">            result = <span class="keyword">this</span>.rowCountResult(sqlSession.insert(<span class="keyword">this</span>.command.getName(), param));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> UPDATE:</span><br><span class="line">            param = <span class="keyword">this</span>.method.convertArgsToSqlCommandParam(args);</span><br><span class="line">            result = <span class="keyword">this</span>.rowCountResult(sqlSession.update(<span class="keyword">this</span>.command.getName(), param));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DELETE:</span><br><span class="line">            param = <span class="keyword">this</span>.method.convertArgsToSqlCommandParam(args);</span><br><span class="line">            result = <span class="keyword">this</span>.rowCountResult(sqlSession.delete(<span class="keyword">this</span>.command.getName(), param));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> SELECT:</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.method.returnsVoid() &amp;&amp; <span class="keyword">this</span>.method.hasResultHandler()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.executeWithResultHandler(sqlSession, args);</span><br><span class="line">                result = <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.method.returnsMany()) &#123;</span><br><span class="line">                result = <span class="keyword">this</span>.executeForMany(sqlSession, args);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.method.returnsMap()) &#123;</span><br><span class="line">                result = <span class="keyword">this</span>.executeForMap(sqlSession, args);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.method.returnsCursor()) &#123;</span><br><span class="line">                result = <span class="keyword">this</span>.executeForCursor(sqlSession, args);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                param = <span class="keyword">this</span>.method.convertArgsToSqlCommandParam(args);</span><br><span class="line">                result = sqlSession.selectOne(<span class="keyword">this</span>.command.getName(), param);</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.method.returnsOptional() &amp;&amp; (result == <span class="keyword">null</span> || !<span class="keyword">this</span>.method.getReturnType().equals(result.getClass()))) &#123;</span><br><span class="line">                    result = Optional.ofNullable(result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> FLUSH:</span><br><span class="line">            result = sqlSession.flushStatements();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Unknown execution method for: &quot;</span> + <span class="keyword">this</span>.command.getName());</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.method.getReturnType().isPrimitive() &amp;&amp; !<span class="keyword">this</span>.method.returnsVoid()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Mapper method &#x27;&quot;</span> + <span class="keyword">this</span>.command.getName() + <span class="string">&quot; attempted to return null from a method with a primitive return type (&quot;</span> + <span class="keyword">this</span>.method.getReturnType() + <span class="string">&quot;).&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> ‘仍然是通过SqlSession中API来db进行交互’</p>
<p> SqlCommand - sql语句对象 - 解析出来的sql语句就被封装到了SqlCommand</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String statementId = mapperInterface.getName() + &quot;.&quot; + methodName;</span><br><span class="line">= this.command.getName();</span><br><span class="line">sqlSession.api方法(namespace.id属性值,..)</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="输入参数类型"><a href="#输入参数类型" class="headerlink" title="输入参数类型"></a>输入参数类型</h1><blockquote>
<ol>
<li>接口中的方法是单个参数,sql标签需要指定参数的类型 - parameterType - 支持类型的别名,如果是自定义的类型,需要提前在mybatis-config.xml主配置文件中进行配置的</li>
<li>散列的类型 - 一定要配置@Param注解 - 无需在sql标签中写parameterType</li>
<li>希望接口更加具备可拓展性的话 - 不建议使用散列的数据</li>
</ol>
<p>如果哪天条件增多/减少,接口是需要变化的.接口是给外部调用的.</p>
<p>使用第三方实体类来封装条件</p>
<ol start="4">
<li>使用Map来封装条件</li>
</ol>
</blockquote>
<h2 id="返回参数类型"><a href="#返回参数类型" class="headerlink" title="返回参数类型"></a>返回参数类型</h2><blockquote>
<ol>
<li>单个参数 - resultType</li>
<li><strong>查询出来的列,没有对应的实体类.需要创建第三方dto对象来封装查询结果</strong></li>
<li>使用Map来作为返回类型</li>
</ol>
</blockquote>
<h1 id="动态SQL语句"><a href="#动态SQL语句" class="headerlink" title="动态SQL语句"></a>动态SQL语句</h1><blockquote>
<p>mybatis映射文件的灵魂 - 支持动态sql以及sql片段[封装sql,然后支持多次调用]</p>
</blockquote>
<h2 id="if标签"><a href="#if标签" class="headerlink" title="if标签"></a>if标签</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">   select * from t_video where 1=1</span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title!=null&quot;</span>&gt;</span></span><br><span class="line">     and title like &#x27;%$&#123;title&#125;%&#x27;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price!=null&quot;</span>&gt;</span></span><br><span class="line">     and price &gt;= #&#123;price&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="where标签"><a href="#where标签" class="headerlink" title="where标签"></a>where标签</h2><blockquote>
<ol>
<li>作用 - 查询语句后面自动拼接where语句</li>
<li>作用 - 去除where语句后面的第一个条件前面的条件连接符号[and,or]</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">  select * from t_video</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title!=null&quot;</span>&gt;</span></span><br><span class="line">      and title like &#x27;%$&#123;title&#125;%&#x27;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price!=null&quot;</span>&gt;</span></span><br><span class="line">      and price &gt;= #&#123;price&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="set标签"><a href="#set标签" class="headerlink" title="set标签"></a>set标签</h2><blockquote>
<p>更新</p>
<ol>
<li>生成set语句</li>
<li>去除最后一个更新列的最后一个逗号</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">  update t_video</span><br><span class="line">  <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title!=null&quot;</span>&gt;</span></span><br><span class="line">      title=#&#123;title&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price!=null&quot;</span>&gt;</span></span><br><span class="line">      price=#&#123;price&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;videoUrl!=null&quot;</span>&gt;</span></span><br><span class="line">      video_url=#&#123;videoUrl&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="foreach标签"><a href="#foreach标签" class="headerlink" title="foreach标签"></a>foreach标签</h2><p>动态 SQL 的另一个常见使用场景是对集合进行遍历（尤其是在构建 IN 条件语句的时候）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findIds&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">   select * from t_video where id in</span><br><span class="line">   <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">     #&#123;item&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>collection属性值可以为list集合的默认的键名 - list,当然自定list的键名,方法参数加上@Param(&quot;ids&quot;)</code></p>
<p><code>item代表是集合中的每一项元素</code></p>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存多条视频信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videos</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">saveList</span><span class="params">(List&lt;Video&gt; videos)</span></span>;</span><br></pre></td></tr></table></figure>

<h1 id="注解开发"><a href="#注解开发" class="headerlink" title="注解开发"></a>注解开发</h1><blockquote>
<p>t_comment 评论表</p>
<p>鼓励单表操作</p>
<p>注解开发和xml开发并存的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommentsMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Select(&quot;select * from t_comment&quot;)</span></span><br><span class="line"> <span class="function">List&lt;Comments&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Delete(&quot;delete from t_comment where id=#&#123;id&#125;&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">delById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Insert(&quot;insert into t_comment values(#&#123;id&#125;,#&#123;userId&#125;,#&#123;videoId&#125;,#&#123;content&#125;,#&#123;commentId&#125;)&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">save</span><span class="params">(Comments comments)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Select(&quot;select * from t_comment where id=#&#123;id&#125;&quot;)</span></span><br><span class="line"> <span class="function">Comments <span class="title">getById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="sql片段"><a href="#sql片段" class="headerlink" title="sql片段"></a>sql片段</h1><blockquote>
<p>主要的作用就是用来封装sql语句,以便sql语句的多次复用.</p>
</blockquote>
<blockquote>
<p>UserMapper.xml</p>
<ol>
<li>sql片段就在当前的映射文件中</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    定义一个sql片段--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;findAllUserSql&quot;</span>&gt;</span></span><br><span class="line">select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    sql标签的id属性的值**一定要和mapper**接口中的方法的名称**高度保持一致--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--select * from t_user--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引用sql片段--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;findAllUserSql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;findAllUserSql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">where id=#&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>需要在A文件中引入B文件中的sql片段</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;B映射文件的namespace.sql片段id属性值&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="resultMap-继承性"><a href="#resultMap-继承性" class="headerlink" title="resultMap - 继承性"></a>resultMap - 继承性</h2><blockquote>
<p>应用场景一: 当<strong>查询的列值不能自动映射</strong>/绑定实体类的属性的时候,需要通过resultMap来进行一一绑定.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getByIdMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getByIdMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">select id uid,username uname from t_user where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>这条语句只需要取出俩条数据 - 手动封装了俩条数据即可</code></p>
</blockquote>
<blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">!--    定义一个sql片段--&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;findAllUserSql&quot;</span>&gt;</span></span><br><span class="line">select id uid,username uname,password,birthday from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;findAllMap&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--select * from t_user--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引用sql片段--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;findAllUserSql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;findAllMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;getByIdMap&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>需要把所有的列数据进行查询绑定</code> - resultMap标签是允许被继承的.</p>
</blockquote>
<h1 id="日志的配置"><a href="#日志的配置" class="headerlink" title="日志的配置"></a>日志的配置</h1><p>Mybatis 通过使用内置的日志工厂提供日志功能。内置日志工厂将会把日志工作委托给下面的实现之一：</p>
<ul>
<li>SLF4J</li>
<li>Apache Commons Logging</li>
<li>Log4j 2</li>
<li><strong>Log4j</strong> - 配置方式比较简单 - 选用的</li>
<li>JDK logging</li>
</ul>
<h2 id="SLF4J日志框架"><a href="#SLF4J日志框架" class="headerlink" title="SLF4J日志框架"></a>SLF4J日志框架</h2><blockquote>
<p>官方地址:<a target="_blank" rel="noopener" href="http://www.slf4j.org/">http://www.slf4j.org/</a></p>
<p><img data-src="/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/%E7%AE%A1%E7%88%B8%E7%88%B8%E7%9A%84%E8%B5%84%E6%96%99/cnm/mybatis-j03s/note/slfj.png" class="lazyload"> </p>
</blockquote>
<blockquote>
<p>市面提供了SLF4J - 日志门面-<strong>接口</strong></p>
<ul>
<li><p>slf4j-api.jar - 日志接口 - slf4j-api-1.7.30.jar - 项目中仅仅只有日志的接口,而没有实现jar - 不ok</p>
</li>
<li><p>springboot框架中推荐使用的日志实现 - logback</p>
<ul>
<li>必须先引入日志门面 - <strong>日志接口</strong> slf4j-api.jar</li>
<li>必须引入日志的具体<strong>的实现</strong> - logback-core.java</li>
</ul>
<blockquote>
<p>不需要中间适配包的原因是slf4j日志框架的创造者和logback日志具体实现的创造者是同一个作者</p>
</blockquote>
</li>
<li><p>mybatis中想要使用log4j</p>
<ul>
<li>①引入<strong>日志接口</strong>slf4j-api.jar   - pc的接口    B -&gt; 5个方法</li>
<li>②<strong>slf4j-log412.jar - 适配包</strong> - usb转接口    C extends B</li>
<li>③引入log4j.jar - log4j<strong>日志具体实现</strong> - 网线接口  D extends C -&gt; 10个方法</li>
</ul>
<blockquote>
<p>slf4j日志接口的作者和log4j作者不是同一个人</p>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#log4j.rootLogger=debug,stdout,logfile</span></span><br><span class="line"><span class="comment"># ERROR - 日志的级别,只有出现错误才会输出日志信息.</span></span><br><span class="line"><span class="comment"># stdout - 将日志信息输出到控制台,不会输出到日志文件</span></span><br><span class="line"><span class="comment"># logfile - 将日志信息输出到日志文件中去.不会在控制台输出</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">INFO,stdout</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.SimpleLayout</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.logfile</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 日志文件的路径</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.File</span>=<span class="string">jbit.log</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="string">%d&#123;yyyy-MM-dd HH:mm:ss&#125; %F %p %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 项目中调用哪个接口中的方法的时候,才会产生日志信息.</span></span><br><span class="line"><span class="meta">log4j.logger.tech.aistar.mapper</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="comment">#log4j.logger.com.mybatis.common.jdbc.SimpleDataSource=DEBUG</span></span><br><span class="line"><span class="comment">#log4j.logger.com.mybatis.common.jdbc.ScriptRunner=DEBUG</span></span><br><span class="line"><span class="comment">#log4j.logger.com.mybatis.sqlmap.engine.impl.SqlMapClientDelegate=DEBUG</span></span><br><span class="line"><span class="comment">#log4j.logger.java.sql.Connection=DEBUG</span></span><br><span class="line"><span class="comment">#log4j.logger.java.sql.Statement=DEBUG</span></span><br><span class="line"><span class="comment">#log4j.logger.java.sql.PreparedStatement=DEBUG</span></span><br><span class="line"><span class="comment">#log4j.logger.java.sql.ResultSet=DEBUG</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    开启小驼峰命名映射--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--        控制台显示sql语句--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="日志的显示级别"><a href="#日志的显示级别" class="headerlink" title="日志的显示级别"></a>日志的显示级别</h2><blockquote>
<p>log4j定义了8个级别的log（除去OFF和ALL，可以说分为6个级别），优先级从高到低依次为：OFF、FATAL、ERROR、WARN、INFO、DEBUG、TRACE、 ALL。</p>
<p>ALL 最低等级的，用于打开所有日志记录。</p>
<p>TRACE designates finer-grained informational events than the DEBUG.Since:1.2.12，很低的日志级别，一般不会使用。</p>
<p><strong>DEBUG 指出细粒度信息事件对调试应用程序是非常有帮助的，主要用于开发过程中打印一些运行信息。</strong></p>
<p><strong>INFO 消息在粗粒度级别上突出强调应用程序的运行过程。打印一些你感兴趣的或者重要的信息，这个可以用于生产环境中输出程序运行的一些重要信息，但是不能滥用，避免打印过多的日志。</strong></p>
<p><strong>WARN 表明会出现潜在错误的情形，有些信息不是错误信息，但是也要给程序员的一些提示。</strong></p>
<p><strong>ERROR 指出虽然发生错误事件，但仍然不影响系统的继续运行。打印错误和异常信息，如果不想输出太多的日志，可以使用这个级别。</strong></p>
<p>FATAL 指出每个严重的错误事件将会导致应用程序的退出。这个级别比较高了。重大错误，这种级别你可以直接停止程序了。</p>
<p>OFF 最高等级的，用于关闭所有日志记录。</p>
</blockquote>
<p>从上到下 - 输出的日志信息肯定是越来越少的.</p>
<h1 id="加载one的一方"><a href="#加载one的一方" class="headerlink" title="加载one的一方"></a>加载one的一方</h1><blockquote>
<p>无论是1加载1,还是<strong>多加载1</strong></p>
<p>查询什么,存储到内存哪里[对象]?  - 实体对象类型[有表对应]/dto对象</p>
</blockquote>
<h2 id="搓的方式"><a href="#搓的方式" class="headerlink" title="搓的方式"></a>搓的方式</h2><blockquote>
<ol>
<li>dto散列的属性和查询列对上号 - <strong>resultType</strong></li>
<li><strong>resultMap</strong> - dto直接关联对象即可.直接使用OGNL语法 - <strong>单个对象</strong>.属性,不能用集合对象.属性</li>
</ol>
</blockquote>
<blockquote>
<p>resultType - 查询出来的列 - pojo属性一致 - 实现自动绑定.</p>
<p>需要自定义一个对象,来封装这些查询列的结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoUserVo</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> Date createDate;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> Double price;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> String videoUrl;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//表中的外键是什么,此处就写什么.</span></span><br><span class="line"> <span class="keyword">private</span> Integer userId;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者使用第三方实体类来进行一个关心的维护,而我们的mybatis支持<strong>ognl语言</strong>[对象导航语言] - 必须维护的是单个对象<br>使用resultMap</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getVideoWithUser2Map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;videoUserVo2&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        此处就是OGNL语法,可以将查询出来的结果映射到videoUserVo2管理的单个对象的video对象的id属性中去--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        ognl - 反射 - video -&gt; getVideo -&gt; Method -&gt; videoUserVo2-&gt;invoke -&gt; Video对象--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        -&gt; Video-Class,id -&gt; setId反射调用--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        手动封装video相关属性--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;video.id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;video.title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;video.price&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;video.createDate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;video.videoUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;video.userId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;user.id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;user.username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;user.password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;user.birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getVideoWithUser2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getVideoWithUser2Map&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">select tv.*,u.username,u.password,u.birthday from t_user u join t_video tv on u.id = tv.user_id where tv.id=21</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="association"><a href="#association" class="headerlink" title="association"></a>association</h1><blockquote>
<p>专门用来映射一的一方</p>
<p>作用:用来把查询出来的结果绑定到type指定的类型中关联的那个单个对象某个属性上.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoUserVo2</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Video video;</span><br><span class="line"> <span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getVideoWithUser3Map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;videoUserVo2&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        绑定一的一方--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;video&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createDate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getVideoWithUser3&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getVideoWithUser3Map&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">select tv.*,u.username,u.password,u.birthday from t_user u join t_video tv on u.id = tv.user_id where tv.id=21</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="resultMap-1"><a href="#resultMap-1" class="headerlink" title="resultMap"></a>resultMap</h2><blockquote>
<p>单表的手动映射的结果进行一个单独的封装 - 查所有列</p>
<p>common-mapper.xml - 存放公共的resultMap</p>
<p><strong>一定要在mybati-config.xml文件中进行读取</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">     <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">     <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;common&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userIdMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userAllMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;videoIdMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;videoAllMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;video&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;videoIdMap&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createDate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;getVideoWithUser4Map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;videoUserVo2&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        绑定一的一方--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">resultMap</span>=<span class="string">&quot;common.videoAllMap&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;video&quot;</span> <span class="attr">property</span>=<span class="string">&quot;video&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;common.userMap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getVideoWithUser4&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;getVideoWithUser4Map&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">select tv.*,u.username,u.password,u.birthday from t_user u join t_video tv on u.id = tv.user_id where tv.id=21</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h1><p><strong>什么是延迟加载: 延迟加载就是当两个表有关联的时候, 但我们查询只需要查询一张表, 比如说订单和用户, 我只需要订单信息, 但sql对这两张表关联了, 会查询全部的信息出来, 这时候要用到<association>标签了, 并在xml文件中开启懒加载, 并将积极加载改为消极加载,  当我们就查询订单表的时候并不会对用户表进行查询操作,  只查询到订单的信息, 当我们需要用到另一张用户表的时候才会去执行查询用户的信息</association></strong></p>
<blockquote>
<p>懒加载</p>
<p>查询many方,希望延迟加载出one方.</p>
<p>分析 - select tv.*,u.username,u.password,u.birthday from t_user u join t_video tv on u.id = tv.user_id where tv.id=21</p>
<p>进行了多表的关联查询 - 不管实际的业务 - 俩张表中的数据全部加载出来了 - 迫切</p>
<p>延迟加载 </p>
<ol>
<li>只查询many方 - 视频</li>
<li>如果业务中需要加载出视频对应的one方法[User] - 才会去查询这个视频的用户信息.如果不需要one方,不会去执行查询user的sql.</li>
</ol>
</blockquote>
<h2 id="第一种方式-推荐"><a href="#第一种方式-推荐" class="headerlink" title="第一种方式 - 推荐"></a>第一种方式 - 推荐</h2><blockquote>
<p>回忆jdbc写法 - 对象只会id[Video类 - user_id属性]</p>
<p>IVideoDao.java - Video getById(Integer id);//根据id查询视频 select * from t_video where id=?</p>
<p>IUserDao.java - User getById(Integer id);//根据用户id查询用户 select * from t_user where id=?</p>
</blockquote>
<blockquote>
<p>按需加载 - 必须在业务层中进行一个处理了.</p>
<p><strong>IVideoSerivce.java</strong></p>
<p><strong>Video findById(Integer id);</strong></p>
<p><strong>VideoVo findVideoUser(Integer id);</strong></p>
</blockquote>
<blockquote>
<p>业务只需要加载视频信息 - videoDao.findById(1);</p>
<p><strong>需要加载视频以及对应的user</strong></p>
<p>@Override</p>
<p>public VideoVo findVideoUser(Integer id){</p>
<p>​        VideoVo vo = new VideoVo();</p>
<p>​        Video v = videoDao.findById(1);</p>
<p>​        User user = userDao.findById(v.getUserId());</p>
<p>​        vo.setVideo(v);</p>
<p>​        vo.setUser(user);    </p>
<p>​        return vo;</p>
<p>}</p>
</blockquote>
<h2 id="第二种方式-mybatis特性"><a href="#第二种方式-mybatis特性" class="headerlink" title="第二种方式 - mybatis特性"></a>第二种方式 - mybatis特性</h2><blockquote>
<p><strong>resultMap + association</strong>/collection</p>
</blockquote>
<blockquote>
<ol>
<li>需要开启一下延迟记载的设置 - mybatis-config.xml</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        只要触发对象的equals,clone,hashCode,toString - 延迟效果都会失效了.--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadTriggerMethods&quot;</span> <span class="attr">value</span>=<span class="string">&quot;clone&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>只要触发对象的equals,clone,hashCode,toString - 延迟效果都会失效了.</li>
<li>xml</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    延迟加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getVideoLazyLoadUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;videoLazyMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select * from t_video where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;videoLazyMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;videoUserVo2&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--        手动映射--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;video&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createDate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--        延迟加载出videoUserVo2 - user信息</span></span><br><span class="line"><span class="comment">            column = &quot;user_id&quot; 把该列的值传给了select引用的查询语句中的#&#123;id&#125;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;tech.aistar.mapper.UserMapper.getById&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="加载many的一方"><a href="#加载many的一方" class="headerlink" title="加载many的一方"></a>加载many的一方</h1><blockquote>
<p>根据用户的id来查询用户信息,顺便加载出该用户下所有的视频信息</p>
</blockquote>
<h2 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserQueryVo</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Video&gt; videoList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserWithVideos&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;findUserWithVideosMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select u.id uid,u.username,u.password,u.birthday,v.* from t_user u</span><br><span class="line">  left join t_video v on v.user_id = u.id where u.id=#&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;findUserWithVideosMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;userQueryVo&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--        处理user对象的属性的绑定--&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--        绑定到一个集合属性videoList ofType集合属性的泛型--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;videoList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createDate&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoUrl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserQueryVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Video&gt; videoList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h1><blockquote>
<p>针<strong>对单表操作进行分页.针对的是实体对象进行分页的.</strong></p>
</blockquote>
<blockquote>
<p>导入 - pagehelper-4.1.6.jar,jsqlparser-1.0.jar</p>
<p>分页的动作肯定是在service层进行的 - 将来的动作.</p>
</blockquote>
<blockquote>
<p>mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageHelper&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>如果数据量特别大 - 分页插件的效率就会变得很低 - 手写分页,改写分页插件.</p>
<p>limit性能是受到偏移量的影响,偏移量[第一个参数?]越大,性能越低</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id uid,username uname,password,birthday <span class="keyword">from</span> t_user limit ?,?</span><br></pre></td></tr></table></figure>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">覃烽</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/">http://example.com/2021/08/31/mybatis%E5%AD%A6%E4%B9%A0-%E4%B8%80/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com">LuckyFeng的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mybatis/">mybatis    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/09/22/spring/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>spring</span></div></a></div><div class="next-post pull_right"><a href="/2021/08/31/JDBC%E6%80%BB/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>JDBC总</span></div></a></div></nav></div></div><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2022 By 覃烽</div><div class="framework-info"><span>驱动 </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="/js/third-party/canvas-nest.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script></body></html>